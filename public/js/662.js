/*! For license information please see 662.js.LICENSE.txt */
(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[662],{95512:(e,t,i)=>{"use strict";i.d(t,{y:()=>a});var s=i(19663);class a extends s.m{constructor(e){super(),this.id="DISABLE_CURSOR_MESH",this.payload={disable:e}}}},20217:(e,t,i)=>{"use strict";i.d(t,{Cy:()=>a,EG:()=>n,HF:()=>r,ho:()=>o});var s=i(19663);class a extends s.m{constructor(e){super(),this.payload=e,this.id="DOLLHOUSE_VERTICAL_LIMITS"}}class o extends s.m{constructor(){super(),this.id="SNAP_DOLLHOUSE_UPPER_LIMIT"}}class n extends s.m{constructor(){super(),this.id="SWAP_MOUSE_BTN_ACTION"}}class r extends s.m{constructor(){super(),this.id="RESTORE_MOUSE_BTN_ACTION"}}},61282:(e,t,i)=>{"use strict";i.d(t,{N2:()=>l,O8:()=>p,SI:()=>a,TD:()=>m,bC:()=>v,bp:()=>d,jX:()=>u,mP:()=>h,pj:()=>n,qj:()=>c,uQ:()=>o,v0:()=>g,zf:()=>r});var s=i(69505);const a=1e3/60,o=89*s.Ue,n=90*s.Ue,r=.001*s.Ue,d=10*s.Ue,l=20*s.Ue,c=.25,h=500,u=.1,m=.16,p=.08,g=Math.PI/1e3,v=.02},10840:(e,t,i)=>{"use strict";i.d(t,{T:()=>g});var s=i(81396),a=i(11677),o=i(44724),n=i.n(o),r=i(7188),d=i.n(r),l=i(52059),c=i.n(l),h=i(75215),u=i.n(h),m=i(56449),p=i.n(m);const g={endpoint:{uniforms:{opacity:{type:"f",value:1},color:{type:"c",value:new s.Color},bg:{type:"t",value:null}},vertexShader:a.Z.basicTextured.vertexShader,fragmentShader:n()},line:{uniforms:s.UniformsUtils.merge([s.UniformsLib.common,s.UniformsLib.fog,{linewidth:{value:4},resolution:{value:new s.Vector2(0,0)},dashScale:{value:1},dashSize:{value:.025},gapSize:{value:.05},mask:{value:null}}]),vertexShader:d(),fragmentShader:c()},screenline:{uniforms:{lineWidth:{value:1},screenSize:{value:new s.Vector2(0,0)},dashed:{value:0},dashSize:{value:1},gapSize:{value:1},antialiasWidth:{value:1},color:{value:new s.Color(1,0,0)},opacity:{value:1},start:{value:new s.Vector3},end:{value:new s.Vector3}},vertexShader:u(),fragmentShader:p()}}},39564:(e,t,i)=>{"use strict";i.d(t,{t:()=>o});var s=i(67992),a=i(15637);class o extends s.V{constructor(e){super(),this.name="notes-data",this.notes=(0,a.q)(e)}iterate(e){for(const t of this.notes)e(t)}updateNote(e){this.notes.has(e.id)?this.notes.get(e.id).copy(e):this.notes.set(e.id,e)}updateNoteProperties(e,t){if(this.notes.has(e)){const i=this.notes.get(e);let s=!1;void 0!==t.resolved&&t.resolved!==i.resolved&&(i.resolved=t.resolved,s=!0),void 0!==t.color&&t.color!==i.color&&(i.color=t.color,s=!0),void 0!==t.anchorPosition&&t.anchorPosition!==i.anchorPosition&&(i.anchorPosition=t.anchorPosition,s=!0),void 0!==t.stemNormal&&t.stemNormal!==i.stemNormal&&(i.stemNormal=t.stemNormal,s=!0),void 0!==t.stemLength&&t.stemLength!==i.stemLength&&(i.stemLength=t.stemLength,s=!0),void 0!==t.stemEnabled&&t.stemEnabled!==i.stemEnabled&&(i.stemEnabled=t.stemEnabled,s=!0),void 0!==t.floorId&&t.floorId!==i.floorId&&(i.floorId=t.floorId,s=!0),void 0!==t.roomId&&t.roomId!==i.roomId&&(i.roomId=t.roomId,s=!0),s&&i.commit()}}removeNote(e){this.notes.has(e)&&(this.notes.delete(e),this.commit())}getNote(e){return this.notes.get(e)}getNoteProperties(e){const t=this.notes.get(e);if(!t)return null;return Object.assign({},t)}get collection(){return this.notes}}},72957:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>J});var s=i(97542),a=i(54244),o=i(10374),n=i(34029),r=i(79728),d=i(89570),l=i(92810),c=i(80742),h=i(80008),u=i(85679),m=i(92294),p=i(39564),g=i(39693),v=i(59512),f=i(96776),w=i(75668),y=i(20241),S=i(28269),b=i(635),E=i(53954),D=i(87953),I=i(32683),C=i(47309),O=i(35221),A=i(5823),x=i(26158),M=i(46391),R=i(63422),T=i(38399),V=i(71166),N=i(56163),P=i(76957),L=i(12039),F=i(15004),k=i(84784);class B extends N.K{constructor(e,t,i,s,a,o,n){super(e,t,s),this.room=a,this.title=o,this.id=this.room.id,this.icon=`icon-${(0,F.mX)(this.room.roomTypeIds)}`,this.typeId=A.SF.MODELROOM,this.layerId=R.gi,this.dateBucket=O.Z.OLDER,this.enabled=!0,this.onSelect=async()=>{super.onSelect(),await this.commandBinder.issueCommand(new L.SG(this.room))},this.floorId=n,this.roomId=a.id;const r=i.tryGetProperty(x.F.UnitType,M.M.IMPERIAL);this.description=this.room.getMeasurementText(r)}}var W=i(97704),H=i(39011),_=i(17788),U=i(22999),z=i(97998),j=i(78283);const G=new z.Z("MdsRoomBoundsDeserializer");class ${deserialize(e){var t,i,s,a,o,n,r,d,l,c,h,u,m,p,g,v;const f={version:0,floors:{}};for(const r of e.floors||[]){const e={edges:{},vertices:{},rooms:{}};f.floors[r.id]=e;for(const s of r.vertices||[])s?e.vertices[s.id]={x:s.position.x,y:s.position.y,layerId:null!==(i=null===(t=s.layer)||void 0===t?void 0:t.id)&&void 0!==i?i:R.gi}:G.warn("Found null vertex in floor vertices!");for(const t of r.edges||[]){if(!t||null===t.thickness||null===t.centerLineBias){G.warn("Invalid edge!");continue}const i={vertices:(t.vertices||[]).map((e=>null==e?void 0:e.id)),thickness:t.thickness,bias:t.centerLineBias,openings:{},type:t.type||void 0,layerId:null!==(a=null===(s=t.layer)||void 0===s?void 0:s.id)&&void 0!==a?a:R.gi};e.edges[t.id]=i;for(const e of t.openings||[]){if(!e){G.warn("Found null opening!");continue}const t={height:e.height,lowerElevation:e.lowerElevation,relativePos:e.relativeCenter,type:e.type,width:e.width,layerId:null!==(n=null===(o=e.layer)||void 0===o?void 0:o.id)&&void 0!==n?n:R.gi};i.openings[e.id]=t}}}for(const t of e.rooms||[]){if(!t||!t.floor){G.warn("Found null room");continue}if(!f.floors[t.floor.id]){G.warn("Unable to find floor for room!");continue}const e=t.classifications||[].sort(((e,t)=>(e.confidence||0)-(t.confidence||0))),i=null===(r=t.dimensionEstimates)||void 0===r?void 0:r.units,s=(t.label||"").trim();f.floors[t.floor.id].rooms[t.id]={edges:(null===(l=null===(d=t.boundary)||void 0===d?void 0:d.edges)||void 0===l?void 0:l.map((e=>e.id)))||[],holes:(null===(c=t.holes)||void 0===c?void 0:c.map((e=>{var t;return(null===(t=e.edges)||void 0===t?void 0:t.map((e=>e.id)))||[]})))||[],classifications:e,label:s,width:this.ensureMetric("distance",null===(h=t.dimensionEstimates)||void 0===h?void 0:h.width,i),length:this.ensureMetric("distance",null===(u=t.dimensionEstimates)||void 0===u?void 0:u.depth,i),area:this.ensureMetric("area",null===(m=t.dimensionEstimates)||void 0===m?void 0:m.area,i),height:this.ensureMetric("distance",null===(p=t.dimensionEstimates)||void 0===p?void 0:p.height,i)||NaN,layerId:null!==(v=null===(g=t.layer)||void 0===g?void 0:g.id)&&void 0!==v?v:R.gi,keywords:t.keywords||[]}}return f}ensureMetric(e,t,i){if(null!=t&&null!=i){const s=i===A.nL.IMPERIAL,a="area"===e?j.W3:j._F;return s?a(t):t}return NaN}}var q=i(16747),Y=i(65241);const Z=new z.Z("MdsRoomBoundsStore");class K extends _.u{constructor(e,t=!1,i=(()=>{})){super(e),this.writeRepairs=t,this.broadcast=i,this.queuedMutations=[],this.seenRooms=new Map,this.lastUpdates=new Map,this.deserializer=new $}async read(e){var t,i;const s={modelId:this.getViewId()},a=await this.query(U.GetRoomBounds,s,e);return(null===(i=null===(t=null==a?void 0:a.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.floors)?this.validateData(this.deserializer.deserialize(a.data.model)):null}async readClassifications({options:e,localizeFn:t}={}){var i;return((null===(i=(await this.query(U.GetRoomClassifications,{},e)).data)||void 0===i?void 0:i.roomClassifications)||[]).reduce(((e,i)=>(i&&(e[i.id]=t?t(i):i),e)),{})}setReadOnly(e){this.config.readonly=e}queueRemoveEntity(e,t,i){this.queueDeleteRoomsAndBoundaryData(e,t,i)}queueAddNode(e){this.queuedMutations.push(`addBoundaryVertex(modelId: $modelId, id: "${e.id}", vertex: ${this.vertexDetailsFromNode(e)}) { id }`)}queueUpdateNode(e){this.updateEntity("node",e.id,`patchBoundaryVertex(modelId: $modelId, id: "${e.id}", vertex: ${this.vertexDetailsFromNode(e)}) { id }`)}vertexDetailsFromNode(e){return`{\n      floorId: "${e.floorId}",\n      position: { x: ${e.x} y: ${-e.z} }\n      ${this.layerId(e.layerId)}\n    }`}queueRemoveNode(e){this.queueRemoveEntity("node",e.id,e.layerId)}queueAddWall(e){this.queuedMutations.push(`addBoundaryEdge(modelId: $modelId, id: "${e.id}", edge: ${this.edgeDetailsFromWall(e)}) { id }`)}queueUpdateWall(e){this.updateEntity("wall",e.id,`patchBoundaryEdge(modelId: $modelId, id: "${e.id}" edge: ${this.edgeDetailsFromWall(e)}) { id }`)}edgeDetailsFromWall(e){return`\n    {\n      floorId: "${e.floorId}"\n      vertices: ["${e.from.id}", "${e.to.id}"]\n      thickness: ${e.width}\n      units: ${A.nL.METRIC}\n      centerLineBias: ${1-e.bias}\n      type: ${e.type===q.d.SOLID?A.Pb.WALL:A.Pb.INVISIBLE}\n      ${this.layerId(e.layerId)}\n    }\n    `}queueRemoveWall(e){this.queueRemoveEntity("wall",e.id,e.layerId)}queueAddOpening(e){this.queuedMutations.push(`addEdgeOpenings(modelId: $modelId, id: "${e.wallId}", openings: [${this.openingDetailsFromOpening(e)}]) { id }`)}queueUpdateOpening(e){this.updateEntity("opening",e.id,`patchEdgeOpening(modelId: $modelId, id: "${e.wallId}", opening: ${this.openingDetailsFromOpening(e)}) { id }`)}openingDetailsFromOpening(e){return`\n    {\n      id: "${e.id}"\n      relativeCenter: ${e.relativePos}\n      type: ${e.type}\n      width: ${e.width}\n      ${this.layerId(e.layerId)}\n      height: 0.1,\n      lowerElevation: 0.1\n    }\n    `}queueRemoveOpening(e){this.queuedMutations.push(`removeEdgeOpenings(\n        modelId: $modelId\n        id: "${e.wallId}"\n        openings: ["${e.id}"]\n        layerId: "${e.layerId}"\n      )`),this.clearEntityUpdate("opening",e.id)}queueAddRoom(e){this.queuedMutations.push(`addRoom(\n        modelId: $modelId,\n        id: "${e.id}",\n        room: ${this.getRoomDetailsFromRoom(e)}\n      ) { id }`)}queueUpdateRoom(e){const t=this.seenRooms.get(e.id);t&&t!==e&&this.clearEntityUpdate("room",e.id),this.seenRooms.set(e.id,e),this.updateEntity("room",e.id,`patchRoom(\n        modelId: $modelId,\n        id: "${e.id}",\n        room: ${this.getRoomDetailsFromRoom(e)}\n      ) { id }`)}getRoomDetailsFromRoom(e){const t=!e.showDimensions,i=!e.showHeight;return`\n    {\n      floorId: "${e.floorId}"\n      label: "${this.escapeUserString(e.name)}"\n      classifications: [${e.roomTypeIds.map((e=>`"${e}"`))}],\n      ${this.layerId(e.layerId)}\n      boundary: {\n        edges: [${Array.from(e.walls.values()).map((e=>`"${e.id}"`))}],\n      }\n      holes: [${Array.from(e.holes.values()).map((e=>`{ edges: [${Array.from(e.values()).map((e=>`"${e.id}"`))}] }`))}]\n      dimensionEstimates: {\n        room: "${e.id}",\n        area: ${Number.isNaN(e.area)?0:e.area},\n        areaIndoor: ${Number.isNaN(e.area)?null:e.area},\n        depth: ${Number.isNaN(e.length)||t?0:e.length}\n        width: ${Number.isNaN(e.width)||t?0:e.width}\n        height: ${Number.isNaN(e.height)||i?0:e.height}\n        units: ${A.nL.METRIC}\n      }\n      keywords: [${e.allKeywords().map((e=>`"${e}"`))}]\n    }\n    `}queueRemoveRoom(e){this.seenRooms.delete(e.id),this.queueRemoveEntity("room",e.id,e.layerId)}queueRemoveLegacyRooms(e){const t=e.map((e=>`"${e}"`));this.queuedMutations.push(`deleteRoomsAndBoundaryData(\n      modelId: $modelId,\n      selectedData: {\n        ids: [${t.join(",")}],\n        type: ${A.TS.ROOM}\n      }\n    )`)}queueUpdateRoomAssociations(e){if(0===e.length)return;this.queuedMutations.push(`bulkPatchRoomData(\n        modelId: $modelId,\n        updatedRoomAssociations: [${e.map((e=>(e=>`{ ${Object.keys(e).map((t=>`${t}: ${JSON.stringify(e[t])}`)).join(",")} }`)(e)))}]\n      )`)}async submitQueuedMutations(){if(0===this.queuedMutations.length)return;const e=this.queuedMutations.slice();this.queuedMutations.length=0;for(const e of this.lastUpdates.values())e.clear();const t=Math.ceil(e.length/100);for(let i=0;i<t;i++){const t=100*i,s=Math.min(t+100,e.length),a=e.slice(t,s),o=W.gql`
        mutation updateRoomBoundaries($modelId: ID!) {
          ${a.map(((e,t)=>`op${t}: ${e}`)).join("\n")}
        }
      `;Z.debug((0,H.S)(o)),await this.mutate(o,{modelId:this.getViewId()}),Z.debug(`Batch ${i} mutation successful`)}}clearQueuedMutations(){this.queuedMutations.length=0;for(const e of this.lastUpdates.values())e.clear()}updateEntity(e,t,i){const s=this.lastUpdates.get(e)||new Map;this.lastUpdates.set(e,s);const a=s.get(t);void 0!==a?this.queuedMutations[a]=i:(this.queuedMutations.push(i),s.set(t,this.queuedMutations.length-1))}clearEntityUpdate(e,t){const i=this.lastUpdates.get(e);i&&i.delete(t)}queueDeleteRoomsAndBoundaryData(e,t,i){let s=A.TS.BOUNDARYVERTEX;switch(e){case"room":s=A.TS.ROOM;break;case"wall":s=A.TS.BOUNDARYEDGE}this.queuedMutations.push(`deleteRoomsAndBoundaryData(\n        modelId: $modelId,\n        selectedData: {\n          ids: ["${t}"],\n          type: ${s},\n          ${this.layerId(i)}\n        }\n      )`),this.clearEntityUpdate(e,t)}layerId(e){return e!==R.gi?`layerId: "${e}"`:""}escapeUserString(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}validateData(e){var t,i,s;const a=this.config.readonly||!this.writeRepairs;Object.values(e.floors).forEach((e=>{const t={};Object.values(e.edges).forEach((e=>{e.vertices&&e.vertices.forEach((e=>{t[e]=!0}))}));const i={};Object.entries(e.vertices).forEach((([e,s])=>{t[e]?i[e]=s:a?this.broadcast(new Y.$(`validateData: Would delete orphan node: ${e}`)):(this.broadcast(new Y.$(`validateData: Deleting orphan node: ${e}`)),this.queueRemoveEntity("node",e,s.layerId))})),e.vertices=i})),Object.values(e.floors).forEach((e=>{Object.entries(e.edges).forEach((([t,i])=>{var s;2===(null===(s=i.vertices)||void 0===s?void 0:s.length)&&e.vertices[i.vertices[0]]&&e.vertices[i.vertices[1]]||(delete e.edges[t],a?this.broadcast(new Y.$(`validateData: Would delete invalid wall: ${t}`)):(this.broadcast(new Y.$(`validateData: Deleting invalid wall: ${t}`)),this.queueRemoveEntity("wall",t,i.layerId)))}))}));for(const o of Object.values(e.floors))for(const e of Object.keys(o.rooms)){const n=o.rooms[e];let r=!1;const d=(null!==(t=n.edges)&&void 0!==t?t:[]).concat(null!==(s=null===(i=n.holes)||void 0===i?void 0:i.flat())&&void 0!==s?s:[]);for(const e of d){o.edges[e]||(r=!0)}r&&(a?this.broadcast(new Y.$(`validateData: Would delete invalid room: ${e}`)):(this.broadcast(new Y.$(`validateData: Deleting invalid room: ${e}`)),this.queueRemoveEntity("room",e,n.layerId)),delete o.rooms[e])}return Object.values(e.floors).forEach((e=>{const t=(t,i)=>{a?this.broadcast(new Y.$(`validateData: Would delete existing wall: ${t}`)):(this.broadcast(new Y.$(`validateData: Deleting existing wall: ${t}`)),this.queueRemoveEntity("wall",t,i)),delete e.edges[t]},i=new Set;Object.values(e.rooms).forEach((e=>{for(const t of e.edges||[])i.add(t)}));const s=new Map;Array.from(Object.entries(e.edges)).forEach((([a,o])=>{if(!o.vertices)return;const n=o.vertices.sort().join(":");if(s.has(n))if(i.has(a)){const o=s.get(n);if(o&&!i.has(o)){const i=e.edges[o];t(o,i.layerId),s.set(n,a)}}else t(a,o.layerId);else s.set(n,a)}))})),a||this.submitQueuedMutations(),e}}class X extends s.Y{constructor(){super(...arguments),this.name="room_bound_data",this.associationSources=[],this.modifiedFloors=new Set,this.afterFinalize=async()=>{if(!this.writeBindings)throw new Error("Not permitted to write room bounds data");try{this.store.queueUpdateRoomAssociations(this.updateRoomAssociations()),await this.store.submitQueuedMutations()}catch(e){this.log.info("Error finalizing room bounds data",e),this.data.clearUndoBuffer();const t=await this.store.read();throw this.writeBindings.cancel(),this.data.load(t||{version:0,floors:{}}),this.data.commit(),this.writeBindings.renew(),e}},this.addRoom=e=>{this.roomData.get(e.id)||this.roomData.add(new y.d({id:e.id,floorId:e.floorId,meshSubgroup:-1})),this.addToModifiedFloors(e),this.data.legacyRoomIds.length&&(this.store.queueRemoveLegacyRooms(this.data.legacyRoomIds),this.data.legacyRoomIds.forEach((e=>this.roomData.remove(e))),this.data.legacyRoomIds.length=0),this.store.queueAddRoom(e)},this.removeRoom=e=>{this.roomData.get(e.id)&&this.roomData.remove(e.id),this.addToModifiedFloors(e),this.store.queueRemoveRoom(e)}}async init(e,t){const[i,s,h,u]=await Promise.all([t.market.waitForData(c.R),t.market.waitForData(S.Z),t.market.waitForData(a.pu),t.market.waitForData(n.e)]);this.roomData=s,this.layersData=i,this.issueCommand=t.commandBinder.issueCommand;const m=i.getBaseModelView();if(!m)throw new Error("Unable to find view for RoomBound data");this.localeModule=await t.getModuleBySymbol(l.e9),this.store=new K({viewId:m.id,context:i.mdsContext,readonly:e.readonly,baseUrl:e.baseUrl},1===u.getOverrideParam("rbeRepair",0),t.broadcast.bind(t));const p=await this.store.read(),g=await this.store.readClassifications({localizeFn:e=>this.localizeRoomClassification(e)});w.Ds.forEach((e=>{const t=e.join(w.Rt);g[t]={id:t,label:e.map((e=>{var t;return(null===(t=g[e])||void 0===t?void 0:t.label)||[]})).join(w.X9),defaultKeywords:(0,I.Hc)(e.map((e=>g[e])))}})),this.data=new D.Z(p,g,t.broadcast.bind(t)),this.data.commit(),this.data.clearUndoBuffer(),this.data.resetHistory(),e.readonly||(this.writeBindings=new d.V(this.data.onWallsChanged({onAdded:e=>{this.addToModifiedFloors(e),this.store.queueAddWall(e)},onUpdated:e=>{this.addToModifiedFloors(e),this.store.queueUpdateWall(e)},onRemoved:e=>{this.addToModifiedFloors(e),this.store.queueRemoveWall(e)}}),this.data.onNodesChanged({onAdded:e=>{this.addToModifiedFloors(e),this.store.queueAddNode(e)},onUpdated:e=>{this.addToModifiedFloors(e),this.store.queueUpdateNode(e)},onRemoved:e=>{this.addToModifiedFloors(e),this.store.queueRemoveNode(e)}}),this.data.onRoomsChanged({onAdded:this.addRoom,onUpdated:e=>{this.addToModifiedFloors(e),this.store.queueUpdateRoom(e)},onRemoved:this.removeRoom}),this.data.onOpeningsChanged({onAdded:e=>{this.addToModifiedFloors(e),this.store.queueAddOpening(e)},onUpdated:e=>{this.addToModifiedFloors(e),this.store.queueUpdateOpening(e)},onRemoved:e=>{this.addToModifiedFloors(e),this.store.queueRemoveOpening(e)}}),this.data.afterFinalize((async()=>{await t.commandBinder.issueCommand(new b.V({dataTypes:[r.g.ROOM_BOUNDS],onCallback:this.afterFinalize,skipDirtyUpdate:!0}))}))),this.writeBindings.cancel()),await this.updateForApp(t,h.application),this.bindings.push(t.subscribe(o.bS,(e=>this.updateForApp(t,e.application)))),await this.registerRoomAssociationSources(t),this.store.clearQueuedMutations(),async function(e,t){const[i,s,o,r,h]=await Promise.all([e.market.waitForData(a.pu),e.market.waitForData(c.R),e.market.waitForData(n.e),e.market.waitForData(P.i),e.getModuleBySymbol(l.e9)]);let u=i.application===a.Mx.WORKSHOP;const m=(i,a,n,d=[])=>{if(!u&&!o.tryGetProperty(C.hW,!1))return[];if(d.length>0)return[];const l=[];for(const n of t.rooms.values()){const d=(0,k.LN)(n.id,h,t);if(i(n.name)||i(d)){const t=r.getFloor(n.floorId);if(!t)throw new Error("Unable to find floor for room while generating search results.");l.push(new B(e.commandBinder,s,o,a,n,d,t.id))}}return l.sort(((e,t)=>e.title.localeCompare(t.title)))},p=e=>{},g=e=>new d.V(t.onChanged(e),o.onPropertyChanged(x.F.UnitType,e)),v={renew:()=>{e.commandBinder.issueCommandWhenBound(new V.c6({id:A.SF.MODELROOM,groupPhraseKey:T.Z.SHOWCASE.ROOMS.SEARCH_GROUP_HEADER,getSimpleMatches:m,registerChangeObserver:g,onSearchActivatedChanged:p,groupOrder:100,groupIcon:"edit-floorplan",batchSupported:!1}))},cancel:()=>{e.commandBinder.issueCommandWhenBound(new V.Pe(A.SF.MODELROOM))}},f=()=>{u=i.application===a.Mx.WORKSHOP,o.tryGetProperty(C.hW,!1)||u?v.renew():v.cancel()},w=i.onPropertyChanged("application",f),y=o.onPropertyChanged(C.hW,f);return f(),new d.V(v,w,y)}(t,this.data).then((e=>this.bindings.push(e))),t.market.register(this,D.Z,this.data)}dispose(e){super.dispose(e),this.writeBindings&&this.writeBindings.cancel()}localizeRoomClassification(e){return this.localeModule?Object.assign(Object.assign({},e),{label:(0,k.Nw)(e,this.localeModule)}):e}trackRoomBoundsABTest(e,t){Promise.all([e.getModuleBySymbol(l.V6),e.market.waitForData(n.e)]).then((([e,i])=>{const s=this.data.rooms.size>0,o=t===a.Mx.WORKSHOP||s&&(0,C.G)(i);e.trackFeatures(`${C.A0}:${o}`)}))}async updateForApp(e,t){this.trackRoomBoundsABTest(e,t);const i=t===a.Mx.SHOWCASE;if(this.store.setReadOnly(i),this.writeBindings)if(i)this.writeBindings.cancel();else{this.writeBindings.renew(),await this.issueCommand(new h.fk);const e=this.layersData.getViewLayerIdForBaseView();if(!e)throw Error("Cannot edit rooms without base view view-data layer");this.data.defaultLayerId=e,this.data.validateGraph()}}addToModifiedFloors(e){this.modifiedFloors.add(e.floorId)}updateRoomAssociations(){const e=new Map;for(const t of this.associationSources)for(const i of t.getPositionId()){if(!i.floorId||!this.modifiedFloors.has(i.floorId))continue;const s=this.data.findRoomIdForPosition(i.position,i.floorId,i.roomId);if(s!=i.roomId){const a=e.get(s)||(s?{roomId:s}:{resetRoom:!0}),o=a[t.type]||[];o.push(i.id),a[t.type]=o,e.set(s,a),t.updateRoomForId(i.id,s)}}return this.modifiedFloors.clear(),Array.from(e.values())}async registerRoomAssociationSources(e){const t=await e.market.waitForData(n.e),i=await e.market.waitForData(u.n);if(this.associationSources.push({type:"mattertags",getPositionId:function*(){for(const e of i)yield{id:e.sid,roomId:e.roomId,floorId:e.floorId,position:e.anchorPosition}},updateRoomForId:(e,t)=>{const s=i.getTag(e);if(!s)throw new Error("Invalid tag id!");s.roomId=t||void 0}}),t.tryGetProperty(g.Mp,!1)){const t=await e.market.waitForData(p.t);this.associationSources.push({type:"notes",getPositionId:function*(){for(const e of t.collection.values)yield{id:e.id,roomId:e.roomId,floorId:e.floorId,position:e.anchorPosition}},updateRoomForId:(e,i)=>{const s=t.getNote(e);if(!s)throw new Error("Invalid note id!");s.roomId=i||void 0}})}const s=await e.market.waitForData(m.X);if(this.associationSources.push({type:"measurements",getPositionId:function*(){for(const e of s.groups())yield{id:e.info.sid,roomId:e.info.roomId,floorId:e.info.floorId,position:e.get(0)}},updateRoomForId:(e,t)=>{const i=s.getGroupInfoBySid(e);if(!i)throw new Error("Invalid measurement group id");i.info.roomId=t||void 0}}),t.tryGetProperty(f.QA,!1)){const t=await e.market.waitForData(v.h);this.associationSources.push({type:"objectAnnotations",getPositionId:function*(){for(const e of t.collection.values)yield{id:e.id,roomId:e.roomId,floorId:e.floorId,position:e.position}},updateRoomForId:(e,i)=>{const s=t.getObjectTag(e);if(!s)throw new Error("Invalid object detection id!");s.roomId=i||void 0}})}const a=await e.market.waitForData(E.Z);this.associationSources.push({type:"locations",getPositionId:function*(){for(const e of a.sweeps())yield{id:e.id,roomId:e.roomId||void 0,floorId:e.floorId||void 0,position:e.position}},updateRoomForId:(e,t)=>{const i=a.getSweep(e);if(!i)throw new Error("Invalid sweep id!");i.roomId=t||null}})}}const J=X},28119:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Ji});var s=i(92810),a=i(97542),o=i(34029),n=i(60975),r=i(6282),d=i(76631),l=i(91380),c=i(50892),h=i(89549),u=i(59625),m=i(71776),p=i(38987),g=i(34956),v=i(39693),f=i(43736),w=i(92001),y=i(65019),S=i(41326),b=i(66917),E=i(75287),D=i(89570),I=i(2224),C=i(97998),O=i(37082),A=i(13693),x=i(98010);const M=new C.Z("editor");var R;!function(e){let t,i;e.DragAndDrop=class{constructor(e=new s){this.state=e,this.events=new A.Y,this.bindings=[],this.validator=null,this.state.commit(),this.bindings.push(this.state.onPropertyChanged("toolState",(()=>{M.debug("toolState:",{from:this.state.previousToolState,to:this.state.toolState},this.state),this.events.broadcast(new i.StateChange(this.state.toolState,this.state.previousToolState))})),this.onSelectedChanged(((e,t)=>{this.events.broadcast(new i.SelectChange(e,t))})),this.onHoveredChanged(((e,t)=>{this.events.broadcast(new i.HoverChange(e,t))})),this.state.onCurrentIdChanged(((e,t)=>{this.events.broadcast(new i.CurrentChange(e,t))}))),this.bindings.forEach((e=>e.cancel()))}subscribe(e,t){return this.events.subscribe(e,t)}setState(e){e!==this.state.toolState&&(this.state.previousToolState=this.state.toolState,this.state.toolState=e,this.state.commit())}start(){const{toolState:e}=this.state;if(e===t.CLOSED)this.bindings.forEach((e=>e.renew()));else if(e!==t.READ_ONLY)throw new a("Editor already started");this.setState(t.IDLE),this.events.broadcast(new i.Start)}startReadOnly(){const{toolState:e}=this.state;if(e===t.CLOSED)this.bindings.forEach((e=>e.renew()));else if(e!==t.IDLE)throw new a("Editor already started");this.setState(t.READ_ONLY)}setEnabled(e){if(this.state.toolState===t.CLOSED)throw new a("Editor not started");if(e)this.state.toolState===t.DISABLED&&this.setState(t.IDLE);else switch(this.state.toolState){case t.DISABLED:break;case t.IDLE:this.setState(t.DISABLED);break;default:this.unhover({commit:!1}),this.deselect({commit:!1}),this.discard(),this.setState(t.DISABLED)}}exit(){this.state.toolState!==t.CLOSED&&(this.state.toolState!==t.DISABLED&&(this.unhover({commit:!1}),this.deselect({commit:!1}),this.discard()),this.setState(t.CLOSED),this.bindings.forEach((e=>e.cancel())),this.events.broadcast(new i.Exit))}setValidator(e){this.validator=e}onDiscard(e){this.state.onBeforeDiscard=e||null}edit(e){if(this.assertActive(),null!==this.state.pendingEdit)throw M.error(`Trying to edit asset ${e}, but currently editing ${this.state.pendingEdit}`),new a("Edit in progress");this.state.pendingEdit=e,this.setState(t.EDITING),this.events.broadcast(new i.EditStart(e,!1))}waitForAdd(){if(this.assertActive(),null!==this.state.pendingAdd)throw M.error(`Entering wait for add state, but already adding ${this.state.pendingAdd}`),new a("Add in progress");null!==this.state.selected&&(M.debug(`Entering the wait for add state, deselecting previous ${this.state.selected}`),this.deselect({commit:!1})),this.events.broadcast(new i.WaitForAddStart),this.setState(t.WAIT_FOR_ADD)}add(e){if(this.assertActive(),null!==this.state.pendingAdd)throw M.error(`Trying to add new asset ${e}, but already adding ${this.state.pendingAdd}`),new a("Add in progress");null!==this.state.selected&&(M.debug(`Add ${e} called, deselecting previous ${this.state.selected}`),this.deselect({commit:!1})),this.state.pendingAdd=e,this.events.broadcast(new i.AddStart(e)),this.setState(t.ADDING)}place(e){this.assertActive();const{pendingAdd:s,pendingEdit:a}=this.state,o=s||a;o&&e===o||(this.state.pendingEdit=e),this.setState(t.PLACING),this.events.broadcast(new i.EditStart(e,!0))}move(e){this.assertActive(),this.validate(e);const{pendingAdd:t,pendingEdit:s,selected:a}=this.state,o=t||s||a;o&&this.events.broadcast(new i.Move(o,e)),this.state.ndcPosition.value=e.clientPosition}highlight(...e){this.assertActive();for(const t of e)this.state.highlighted.add(t),this.events.broadcast(new i.HighlightAdd(t))}clearAllHighlights(){this.assertActive();for(const e of this.state.highlighted)this.events.broadcast(new i.HighlightClear(e));this.state.highlighted.clear()}dim(e){this.assertActive(),this.state.dimmed.add(e),this.events.broadcast(new i.DimAdd(e))}clearDim(e){this.assertActive(),this.state.dimmed.delete(e),this.events.broadcast(new i.DimClear(e))}clearAllDims(){this.assertActive();for(const e of this.state.dimmed)this.events.broadcast(new i.DimClear(e));this.state.dimmed.clear()}select(e,i){this.assertActive(),this.state.pendingAdd||this.state.pendingEdit||(this.state.previousSelected=this.state.selected,this.state.selected=e,this.state.commit(),i&&i.transitionTo?this.setState(i.transitionTo):this.state.isReadonly()?this.setState(t.SELECTED_READ_ONLY):this.setState(t.SELECTED))}toggleSelect(e){this.state.selected===e?this.deselect():this.select(e)}deselect(e={commit:!0}){this.assertActive(),this.state.pendingAdd||this.state.pendingEdit||null!==this.state.selected&&(this.state.previousSelected=this.state.selected,this.state.selected=null,e.commit&&this.state.commit(),e&&e.transitionTo?this.setState(e.transitionTo):this.state.toolState===t.SELECTED_READ_ONLY?this.setState(t.READ_ONLY):this.setState(t.IDLE))}hover(e){this.assertActive(),e!==this.state.hovered&&(this.state.previousHovered=this.state.hovered,this.state.hovered=e,this.state.commit())}unhover(e={commit:!0}){this.state.hovered&&(this.state.previousHovered=this.state.hovered,this.state.hovered=null,e.commit&&this.state.commit())}tryCommit(){this.assertActive();const e=this.state.pendingAdd,t=this.state.pendingEdit;if(!1===this.state.pendingValid)return M.warn("nop, pendingValid",this.state.pendingValid),!1;let s=!1;const a=this.state.selected,o=this.state.pendingAdd||this.state.pendingEdit;if(o){const n=null===this.state.pendingValid||!0===this.state.pendingValid;n&&(this.state.pendingAdd=null,this.state.pendingEdit=null,this.state.pendingValid=null,this.state.onBeforeDiscard=null,t&&this.events.broadcast(new i.EditConfirm(t)),e&&this.events.broadcast(new i.AddConfirm(e)),this.state.pendingAdd||this.state.pendingEdit||a!==this.state.selected||this.select(o)),s=n}return s}discard(){const s=this.state.pendingAdd||this.state.pendingEdit,a=this.state.pendingAdd,o=this.state.pendingEdit;s&&(this.state.onBeforeDiscard&&this.state.onBeforeDiscard(),o&&(this.state.pendingEdit=null,this.events.broadcast(new i.EditDiscard(o))),a&&(this.state.pendingAdd=null,this.events.broadcast(new i.AddDiscard(a))),this.events.broadcast(new e.Events.ValidChange(null,null)),this.state.pendingValid=null,this.state.onBeforeDiscard=null),this.unhover({commit:!1}),this.deselect({commit:!1}),this.state.isReadonly()?this.setState(t.READ_ONLY):this.state.toolState!==t.IDLE&&this.setState(t.IDLE),this.state.commit()}validate(t){const i=this.state.pendingAdd||this.state.pendingEdit||this.state.selected;if(i){const s=this.state.pendingValid;let a=!0;this.validator?(a=this.validator.validate(i,t),this.state.pendingValid=a):this.state.pendingValid=null,null!==this.state.pendingValid&&s!==this.state.pendingValid&&this.events.broadcast(new e.Events.ValidChange(a?i:null,a?null:i))}}assertActive(){if(this.state.toolState===e.ToolState.CLOSED)throw new a("Editor closed");if(this.state.toolState===e.ToolState.DISABLED)throw new a("Editor disabled")}onSelectedChanged(e){return this.state.onPropertyChanged("selected",(()=>e(this.state.selected,this.state.previousSelected)))}onHoveredChanged(e){return this.state.onPropertyChanged("hovered",(()=>e(this.state.hovered,this.state.previousHovered)))}},function(e){e.CLOSED="CLOSED",e.READ_ONLY="READ_ONLY",e.DISABLED="DISABLED",e.IDLE="IDLE",e.SELECTED="SELECTED",e.SELECTED_READ_ONLY="SELECTED_READ_ONLY",e.WAIT_FOR_ADD="WAIT_FOR_ADD",e.ADDING="ADDING",e.EDITING="EDITING",e.PLACING="PLACING"}(t=e.ToolState||(e.ToolState={}));class s extends E.T{constructor(){super(...arguments),this.toolState=t.CLOSED,this.previousToolState=t.CLOSED,this.pendingAdd=null,this.pendingEdit=null,this.selected=null,this.previousSelected=null,this.hovered=null,this.previousHovered=null,this.highlighted=new Set,this.dimmed=new Set,this.ndcPosition=new O.f(null),this.onBeforeDiscard=null,this.pendingValid=null}get currentId(){return this.pendingAdd||this.pendingEdit||this.selected||null}onCurrentIdChanged(e,t=!1){let i=this.currentId;const s=()=>{this.currentId!==i&&(e(this.currentId,i),i=this.currentId)},a=new D.V(this.onPropertyChanged("selected",s),this.onPropertyChanged("pendingAdd",s),this.onPropertyChanged("pendingEdit",s));return t?a.renew():a.cancel(),a}isReadonly(){return this.toolState===t.READ_ONLY||this.toolState===t.SELECTED_READ_ONLY}}e.State=s;class a extends I.y{constructor(e="invalid state"){super(e),this.name="invalid state"}}e.EditorException=a,function(e){class t extends x.v0{}t.type="edit",e.EditEvent=t;class i extends t{constructor(e){super(),this.target=e}}i.type="editt",e.EditTarget=i;class s extends t{constructor(e,t){super(),this.target=e,this.previous=t}}s.type="edittp",e.EditTargetAndPrev=s;class a extends t{constructor(e,t){super(),this.target=e,this.previous=t}}a.type="toolchange",e.StateChange=a;class o extends t{}o.type="editorstart",e.Start=o;class n extends t{}n.type="editorexit",e.Exit=n;class r extends t{}r.type="waitforaddstart",e.WaitForAddStart=r;class d extends i{}d.type="addstart",e.AddStart=d;class l extends i{constructor(e,t){super(e),this.placeOnly=t}}l.type="editstart",e.EditStart=l;class c extends i{}c.type="addconfirm",e.AddConfirm=c;class h extends i{}h.type="adddiscard",e.AddDiscard=h;class u extends i{}u.type="editconfirm",e.EditConfirm=u;class m extends i{}m.type="editdiscard",e.EditDiscard=m;class p extends i{}p.type="delete",e.Delete=p;class g extends i{constructor(e,t){super(e),this.target=e,this.ev=t}}g.type="move",e.Move=g;class v extends s{}v.type="target",e.CurrentChange=v;class f extends s{}f.type="hover",e.HoverChange=f;class w extends s{}w.type="select",e.SelectChange=w;class y extends i{}y.type="highlight",e.HighlightAdd=y;class S extends i{}S.type="highlightclear",e.HighlightClear=S;class b extends i{}b.type="dim",e.DimAdd=b;class E extends i{}E.type="dimclear",e.DimClear=E;class D extends s{}D.type="valid",e.ValidChange=D,e.hasTarget=function(e){return e instanceof i},e.hasTargetAndPrev=function(e){return e instanceof s}}(i=e.Events||(e.Events={}))}(R||(R={}));var T,V=i(87953),N=i(47309),P=i(38127),L=i(90304),F=i(16747),k=i(2482);!function(e){const t={[R.Events.HoverChange.type]:"hoverState",[R.Events.SelectChange.type]:"selectState",[R.Events.ValidChange.type]:"validState",[R.Events.Move.type]:"mover",[R.Events.HighlightAdd.type]:"highlightState",[R.Events.HighlightClear.type]:"highlightState",[R.Events.DimAdd.type]:"dimState",[R.Events.DimClear.type]:"dimState"};e.EditorEntityAdapter=class{constructor(e){this.editor=e,this.bindings=[],this.entities=new Map,this.bindings.push(this.editor.subscribe(R.Events.HoverChange,(e=>this.bindTargetedCallback(R.Events.HoverChange.type,e))),this.editor.subscribe(R.Events.SelectChange,(e=>this.bindTargetedCallback(R.Events.SelectChange.type,e))),this.editor.subscribe(R.Events.ValidChange,(e=>this.bindTargetedCallback(R.Events.ValidChange.type,e))),this.editor.subscribe(R.Events.HighlightAdd,(e=>this.bindTargetedCallback(R.Events.HighlightAdd.type,e))),this.editor.subscribe(R.Events.HighlightClear,(e=>this.bindClearCallback(R.Events.HighlightClear.type,e))),this.editor.subscribe(R.Events.DimAdd,(e=>this.bindTargetedCallback(R.Events.DimAdd.type,e))),this.editor.subscribe(R.Events.DimClear,(e=>this.bindClearCallback(R.Events.DimClear.type,e))),this.editor.subscribe(R.Events.Move,(e=>this.bindMoveCallback(e))))}registerEntity(e,...t){let i=this.entities.get(e);i||(i=[]),i.push(...t),this.entities.set(e,i)}unregisterEntity(e){return this.entities.delete(e)}bindTargetedCallback(e,i){let s=null,a=null;R.Events.hasTargetAndPrev(i)?(s=i.target,a=i.previous):R.Events.hasTarget(i)&&(s=i.target);const o=t[e];if(!o)throw Error(`implement targetted callback for ${e}`);(this.entities.get(a)||[]).forEach((e=>{o in e&&(e[o].active=!1,e[o].off())})),(this.entities.get(s)||[]).forEach((e=>{o in e&&(e[o].active=!0,e[o].on())}))}bindMoveCallback(e){(this.entities.get(e.target)||[]).forEach((t=>{t.mover&&e.target&&t.mover.onMove(e.target,e.ev)}))}bindClearCallback(e,i){let s=null;const a=t[e];R.Events.hasTarget(i)&&(s=i.target),(this.entities.get(s)||[]).forEach((e=>{a in e&&(e[a].active=!1,e[a].off())}))}}}(T||(T={}));var B=i(81396),W=i(59370),H=i(2569);var _;!function(e){e[e.NONE=0]="NONE",e[e.LINE=1]="LINE",e[e.POINT=2]="POINT"}(_||(_={}));const U=(()=>{const e=new B.Vector2,t={target:new B.Vector3,closestLine:new B.Line3,orthoLine:new B.Line3,targetType:_.NONE};return(i,s,a,o)=>{t.target.copy(o),t.targetType=_.NONE;let n=Number.MIN_VALUE;const r=z(i,a);for(const e of r){const{dist:i,weight:a,closestPt:r}=G(e,o,s);i<15&&a>n&&(n=a,t.target.copy(r),t.closestLine.copy(e),t.targetType=_.LINE)}if(t.targetType===_.LINE){let n=Number.MIN_VALUE;const r=z(i,a);for(const i of r)if($(i,t.closestLine)){const{dist:a,weight:r}=G(i,o,s);if(a<7.5&&r>n){(0,H.cB)(i.start.x,i.start.z,i.end.x,i.end.z,t.closestLine.start.x,t.closestLine.start.z,t.closestLine.end.x,t.closestLine.end.z,e)&&(n=r,t.target.set(e.x,0,e.y),t.orthoLine.copy(i),t.targetType=_.POINT)}}}return t}})(),z=(()=>{const e=new B.Line3(new B.Vector3,new B.Vector3),t=new B.Vector3,i=new B.Vector3,s=new B.Vector3,a=new B.Vector3(0,1,0);return function*(o,n){const r=o.getWallsForNode(n),d=o.getWallsForFloor(n.floorId);if(d)for(const o of d)if(!r.has(o)){const n=o.from.getVec3(t),r=o.to.getVec3(i);e.set(n,r),yield e,s.subVectors(r,n).normalize(),s.applyAxisAngle(a,Math.PI/2);const d=i.addVectors(n,s);e.set(n,d),yield e;const l=o.to.getVec3(t),c=i.addVectors(l,s);e.set(l,c),yield e}}})(),j=(()=>{const e=new B.Vector2,t=new B.Vector2,i=new B.Vector3;return(s,a,o)=>{const n=(0,W.q9)(s,a,e,i).screenPosition,r=(0,W.q9)(s,o,t,i).screenPosition;return n.distanceTo(r)}})(),G=(()=>{const e={dist:0,weight:0,closestPt:new B.Vector3};return(t,i,s)=>{const a=t.closestPointToPoint(i,!1,e.closestPt),o=j(s,a,i);e.dist=o;const n=j(s,t.start,a);return e.weight=Math.max(5-.0025*n,0),e}})(),$=(()=>{const e=new B.Vector3,t=new B.Vector3;return(i,s)=>(e.subVectors(i.end,i.start).normalize(),t.subVectors(s.end,s.start).normalize(),Math.abs(e.dot(t))<.1)})();var q,Y,Z=i(32597),K=i(80978),X=i(32683);!function(e){e[e.WALLS=0]="WALLS",e[e.DOORS=1]="DOORS",e[e.OPENINGS=2]="OPENINGS"}(q||(q={})),function(e){e[e.MOVE=0]="MOVE",e[e.START=1]="START",e[e.END=2]="END"}(Y||(Y={}));class J extends R.State{constructor(){super(...arguments),this.addType=q.WALLS,this.wallType=F.d.SOLID,this.wallOpeningType=K.u.DOOR,this.openingEditState=Y.MOVE,this.cursor=g.C.ROOMBOUNDS_DEFAULT}}var Q=i(78596);class ee{constructor(e,t,i,s,a,o){this.editor=e,this.getCursorOrigin=t,this.data=i,this.cameraData=s,this.snappingAxesRenderer=a,this.keyboardState=o,this.readBindings=[],this.writeBindings=[],this.edgeStateOnDragStart={fromOffset:new B.Vector3,toOffset:new B.Vector3,initialGrabPt:new B.Vector3,dragDir:new B.Vector3,fromDirection:new B.Vector3,toDirection:new B.Vector3},this.openingStateOnDragStart={relativeStart:0,relativeEnd:0,wallLine:new B.Line3},this.onMoveStart=({target:e,placeOnly:t})=>{if(e&&t){const t=this.data.getEntity(e);t instanceof F.c?this.onWallMoveStart(t):t instanceof K.E&&this.onWallOpeningMoveStart(t)}},this.mover={onMove:(e,t)=>{const{data:i,editor:s}=this;if(!s.state.currentId)return;const a=s.state.toolState===R.ToolState.ADDING?i.getWall(s.state.currentId).to:i.getEntity(s.state.currentId),o=this.getCursorOrigin();a instanceof k.z?this.onMoveNode(a,o):a instanceof F.c?this.onMoveWall(a,o):a instanceof K.E&&this.onMoveWallOpening(a,o)}},this.mergePointAndStartNewWall=({target:e})=>{const{editor:t}=this;if(t.state.toolState===R.ToolState.ADDING&&e){const t=this.data.getWall(e).to.id,i=this.data.getNode(t),s=i.getVec3(),a=this.data.findNodeOrWallForPosition(s,i.floorId,this.data.getAttachedEntities(i)),o=this.checkForNodeOrWallHit(t);if(this.data.finalizeHistory(),o||a)this.editor.discard(),this.editor.select(t),this.snappingAxesRenderer.hide();else{const{wall:e}=this.data.addTrailingEdgeToNode(this.editor.state.wallType,t,this.getCursorOrigin(),this.data.getLastWallWidth(this.editor.state.wallType));this.editor.add(e)}}},this.finalizeMovePt=({target:e})=>{if(e){const t=this.data.getEntity(e);(t instanceof F.c||t instanceof k.z)&&this.mergeOverlapsOnMoveEnd(t),this.data.finalizeHistory(),this.snappingAxesRenderer.hide()}},this.killLastWall=({target:e})=>{const{data:t,editor:i}=this;i.state.toolState===R.ToolState.ADDING&&(this.clearHighlightedViews(),e&&this.data.undo(),t.finalizeHistory(),this.snappingAxesRenderer.hide())},this.onHoverChange=({target:e,previous:t})=>{if(this.editor.state.toolState===R.ToolState.ADDING)return;if(!e)return this.editor.clearAllDims(),this.editor.clearAllHighlights(),void(this.editor.state.selected&&this.setSelectedView(this.editor.state.selected));const i=this.data.getEntity(e);this.hoverView(i)},this.onCurrentChange=({target:e})=>{this.editor.state.toolState!==R.ToolState.ADDING&&this.clearHighlightedViews(),this.highlightView(e)},this.onSelectChange=({target:e})=>{this.setSelectedView(e)},this.editableEntities=new T.EditorEntityAdapter(this.editor),this.editor.setValidator(this)}addEditableEntity(e,t){this.editableEntities.registerEntity(t,this,e)}removeEditableEntity(e){this.editableEntities.unregisterEntity(e)}activate(e){0===this.readBindings.length?this.readBindings.push(this.editor.subscribe(R.Events.CurrentChange,this.onCurrentChange),this.editor.subscribe(R.Events.SelectChange,this.onSelectChange),this.editor.subscribe(R.Events.HoverChange,this.onHoverChange)):this.readBindings.forEach((e=>e.renew())),e||(0===this.writeBindings.length?this.writeBindings.push(this.editor.subscribe(R.Events.EditStart,this.onMoveStart),this.editor.subscribe(R.Events.AddConfirm,this.mergePointAndStartNewWall),this.editor.subscribe(R.Events.EditConfirm,this.finalizeMovePt),this.editor.subscribe(R.Events.AddDiscard,this.killLastWall)):this.writeBindings.forEach((e=>e.renew())))}deactivate(){this.readBindings.forEach((e=>e.cancel())),this.writeBindings.forEach((e=>e.cancel()))}onWallMoveStart(e){const t=this.getCursorOrigin();e.from.getVec3(this.edgeStateOnDragStart.fromOffset),e.to.getVec3(this.edgeStateOnDragStart.toOffset),this.edgeStateOnDragStart.fromOffset.sub(t),this.edgeStateOnDragStart.toOffset.sub(t),this.edgeStateOnDragStart.initialGrabPt.copy(t),e.getDirection(this.edgeStateOnDragStart.dragDir),this.edgeStateOnDragStart.dragDir.normalize(),this.edgeStateOnDragStart.dragDir.applyAxisAngle(new B.Vector3(0,1,0),Math.PI/2);const i=this.edgeStateOnDragStart.dragDir,s=this.needsWallJoint(e,e.from,i),a=this.needsWallJoint(e,e.to,i);(s||a)&&this.data.addWallJoint(e.id,s?e.from.id:void 0,a?e.to.id:void 0),this.getWallDirection(e,e.from,i,this.edgeStateOnDragStart.fromDirection),this.getWallDirection(e,e.to,i,this.edgeStateOnDragStart.toDirection),i.dot(this.edgeStateOnDragStart.fromDirection)<0&&this.edgeStateOnDragStart.fromDirection.multiplyScalar(-1),i.dot(this.edgeStateOnDragStart.toDirection)<0&&this.edgeStateOnDragStart.toDirection.multiplyScalar(-1)}onWallOpeningMoveStart(e){const t=this.data.getWall(e.wallId),{wallLine:i}=this.openingStateOnDragStart;t.from.getVec3(i.start),t.to.getVec3(i.end);const s=e.width/this.openingStateOnDragStart.wallLine.distance()*.5;this.openingStateOnDragStart.relativeStart=e.relativePos-s,this.openingStateOnDragStart.relativeEnd=e.relativePos+s}onMoveNode(e,t){const i=new B.Vector3,s=this.tryApplySnapping(t,e,i);if(s){const{closestLine:e,orthoLine:t,targetType:i}=s;i===_.LINE||i===_.POINT?i===_.POINT?this.snappingAxesRenderer.showAt(e,t):this.snappingAxesRenderer.showAt(e):this.snappingAxesRenderer.hide()}else this.snappingAxesRenderer.hide();this.data.moveNode(e.id,i)}onMoveWall(e,t){const{initialGrabPt:i,dragDir:s,fromOffset:a,toOffset:o,fromDirection:n,toDirection:r}=this.edgeStateOnDragStart,d=t.clone().sub(i),l=s.dot(d),c=n.clone().multiplyScalar(l),h=i.clone().add(c).add(a),u=r.clone().multiplyScalar(l),m=i.clone().add(u).add(o);this.data.moveWall(e.id,h,m)}onMoveWallOpening(e,t){const{editor:i,openingStateOnDragStart:s}=this,{relativeStart:a,relativeEnd:o,wallLine:n}=s,r=n.closestPointToPointParameter(t,!0);switch(i.state.openingEditState){case Y.MOVE:const t=e.width/n.distance()*.5;r+t<1&&r-t>0&&this.data.editWallOpeningDetails(e.id,{relativePos:r});break;case Y.START:case Y.END:{const t=i.state.openingEditState===Y.START?(o-r)*n.distance():(r-a)*n.distance();if(t<Q.PW&&t<e.width)return;const s=.5*(r+o);this.data.editWallOpeningDetails(e.id,{relativePos:s,width:t})}}}checkForNodeOrWallHit(e){const t=this.data.getNode(e);return this.mergeOverlapsOnMoveEnd(t)}mergeOverlapsOnMoveEnd(e){const t=this.data.findOverlappingEntities(e);if(t){const{nodeOverlaps:i,nodeWallOverlaps:s,collinearWall:a,intersectingWall:o}=t;return this.data.mergeOverlappingEntities(e,i,s,a,o),!0}return!1}clearHighlightedViews(){this.editor.clearAllHighlights()}hoverView(e){e instanceof X.JJ&&this.hoverRoom(e)}setSelectedView(e){if(!e)return void this.editor.clearAllDims();const t=this.data.getEntity(e);t instanceof F.c&&this.editor.highlight(t.from.id,t.to.id),t instanceof X.JJ&&(this.clearHighlightedViews(),this.dimAllRooms(),this.selectRoom(t))}dimAllRooms(){this.editor.clearAllDims();for(const[,e]of this.data.rooms)this.dimRoom(e)}highlightView(e){if(!e)return;const t=this.data.getEntity(e);t instanceof F.c&&this.editor.highlight(e,t.from.id,t.to.id)}selectRoom(e){const t=e.id;this.editor.clearDim(t);for(const t of e.walls)this.editor.clearDim(t.id);for(const t of e.points)this.editor.clearDim(t.id)}hoverRoom(e){const t=e.id;this.editor.clearDim(t);for(const t of e.walls)this.editor.clearDim(t.id);for(const t of e.points)this.editor.clearDim(t.id)}dimRoom(e){const t=e.id;this.editor.dim(t);for(const t of e.walls)this.editor.dim(t.id);for(const t of e.points)this.editor.dim(t.id)}isSnappingDisabled(){return this.keyboardState.isKeyHeld(Z.R.ALT)||this.keyboardState.isKeyHeld(Z.R.SHIFT)}tryApplySnapping(e,t,i){if(i.copy(e),!this.isSnappingDisabled()){const s=U(this.data,this.cameraData,t,e);return i.copy(s.target),s}return null}getAttachedWall(e,t){const i=this.data.getWallsForNode(t);if(i)for(const t of i)if(t!==e)return t;return null}getWallDirection(e,t,i,s){const a=this.getAttachedWall(e,t);if(!a)return void s.copy(i);a.getDirection(s).normalize().equals(L.fU.ZERO)&&s.copy(i)}needsWallJoint(e,t,i){const s=this.data.getWallsForNode(t);for(const t of s){if(t===e)continue;const s=i.dot(t.getDirection().normalize());if(Math.abs(s)<.8)return!0}return!1}validate(e,t){return!0}}var te=i(35895);class ie{constructor(e){this.map=new Map,e.forEach((e=>this.map.set(e.state,e.subs)))}renew(e){(this.map.get(e)||[]).forEach((e=>e.renew()))}cancel(e){if(e){(this.map.get(e)||[]).forEach((e=>e.cancel()))}else this.map.forEach((e=>e.forEach((e=>e.cancel()))))}update(e,t){this.map.set(e,t)}}var se,ae,oe=i(67678),ne=i(80592),re=i(89553),de=i(23612),le=i(86819),ce=i(51788),he=i(82814),ue=i(12039),me=i(94046),pe=i(96154),ge=i(72996),ve=i(15462),fe=i(23885),we=i(12529);!function(e){e[e.BASE=we.z.roomBounds]="BASE",e[e.OPENING_STENCIL=we.z.roomBounds+1]="OPENING_STENCIL",e[e.EDGE_STENCIL=we.z.roomBounds+2]="EDGE_STENCIL",e[e.ROOM=we.z.roomBounds+3]="ROOM",e[e.EDGE=we.z.roomBounds+4]="EDGE",e[e.HIGHLIGHTED_EDGE=we.z.roomBounds+5]="HIGHLIGHTED_EDGE",e[e.OPENING_LINES=we.z.roomBounds+6]="OPENING_LINES",e[e.NODE=we.z.roomBounds+7]="NODE"}(se||(se={})),function(e){e[e.OPENINGS=0]="OPENINGS",e[e.EDGE=1]="EDGE"}(ae||(ae={}));var ye=i(89557);class Se extends B.Mesh{constructor(e,t,i,s){super(t,i),this.roomBoundsId=e,this.cameraData=s,this.animation=new ye.z(0),this.prevColorState={opacity:1,innerColor:new B.Color,outerColor:new B.Color},this.pitchFactor=1,this.raycastEnabled=!0,this.opacity=1,this.selectState={active:!1,on:()=>{this.updateMaterial()},off:()=>{this.updateMaterial()}},this.hoverState={active:!1,on:()=>{this.updateMaterial()},off:()=>this.updateMaterial()},this.highlightState={active:!1,on:()=>this.updateMaterial(),off:()=>this.updateMaterial()},this.dimState={active:!1,on:()=>this.updateMaterial(),off:()=>this.updateMaterial()},this.name=e,this.renderOrder=se.BASE}updateMaterial(){let e=this.colors.baseState;this.dimState.active&&(e=this.colors.dimState),this.hoverState.active&&(e=this.colors.hoverState),(this.highlightState.active||this.selectState.active)&&(e=this.colors.selectState);e!==this.targetColorScheme&&(this.targetColorScheme=e)}tickAnimations(e){this.animation.tick(e)}dispose(){}raycast(e,t){if(!this.raycastEnabled)return;const i=[];super.raycast(e,i),i.length>0&&t.push(i[0])}setPitchFactor(e){this.pitchFactor=e,this.raycastEnabled=(0,W.Eb)(this.pitchFactor)}}var be=i(57216),Ee=i.n(be),De=i(4014),Ie=i.n(De),Ce=i(33057),Oe=i.n(Ce),Ae=i(56413),xe=i.n(Ae),Me=i(27706),Re=i.n(Me),Te=i(73403),Ve=i.n(Te),Ne=i(26274),Pe=i.n(Ne),Le=i(5311),Fe=i.n(Le),ke=i(1621),Be=i.n(ke),We=i(32988),He=i.n(We);const _e={uniforms:{outlineColor:{type:"v4",value:ve.I.BLACK},baseColor:{type:"v4",value:ve.I.SINE},outlinePct:{type:"f",value:.8},radius:{type:"f",value:Q.pp},opacity:{type:"f",value:1}},vertexShader:Ee(),fragmentShader:Ie()},Ue={uniforms:{outlineColor:{type:"v3",value:ve.I.WHITE},color:{type:"v3",value:ve.I.WHITE},lineStart:{type:"v3",value:new B.Vector3},lineEnd:{type:"v3",value:new B.Vector3},width:{type:"f",value:1},selectedWidth:{type:"f",value:.01},opacity:{type:"f",value:1}},vertexShader:Oe(),fragmentShader:xe()},ze={uniforms:{baseColor:{type:"v4",value:ve.I.WHITE},isDoor:{type:"f",value:1},opacity:{type:"f",value:1}},vertexShader:Re(),fragmentShader:Ve()},je={uniforms:{opacity:{type:"f",value:1},centerSpacing:{type:"f",value:24},radius:{type:"f",value:4},color:{type:"v4",value:ve.I.LENS_GRAY}},vertexShader:Pe(),fragmentShader:Fe()},Ge={uniforms:{tip:{type:"v2",value:new B.Vector2},normal:{type:"v2",value:new B.Vector2},height:{type:"f",value:0},color:{type:"v4",value:ve.I.WHITE},opacity:{type:"f",value:1},outline:{type:"f",value:1},outlineColor:{type:"v4",value:ve.I.BLACK},screenSize:{type:"v2",value:new B.Vector2},paddingPx:{type:"f",value:2},widthPx:{type:"f",value:12},heightPx:{type:"f",value:6},aaPaddingPx:{type:"f",value:2},metersPerPx:{type:"f",value:.01}},vertexShader:Be(),fragmentShader:He()};var $e=i(93411),qe=i(73121);const Ye={baseState:{opacity:1,innerColor:ve.I.MIRROR,outerColor:ve.I.PORTAL},hoverState:{opacity:1,innerColor:ve.I.MIRROR,outerColor:ve.I.PORTAL},selectState:{opacity:1,innerColor:ve.I.MP_BRAND,outerColor:ve.I.WHITE},dimState:{opacity:1,innerColor:ve.I.MIRROR,outerColor:ve.I.PORTAL}};class Ze extends B.RawShaderMaterial{constructor(){super({fragmentShader:_e.fragmentShader,vertexShader:_e.vertexShader,uniforms:B.UniformsUtils.clone(_e.uniforms),name:"HandleMaterial",transparent:!0,depthTest:!1,extensions:{derivatives:!0}})}}class Ke extends Se{constructor(e,t){const i=new Float32Array([-1,0,-1,1,0,-1,1,0,1,-1,0,1]),s=new B.BufferGeometry;s.setAttribute("position",new B.Float32BufferAttribute(i,3)),s.setIndex([0,2,1,0,3,2]),super(e,s,new Ze,t),this.targetRadius=.3,this.prevRadius=.3,this.renderOrder=se.NODE,this.colors=Ye,this.animation.onChanged((()=>this.onAnimationChange())),this.onBeforeRender=()=>{this.material.uniforms.opacity.value=this.opacity*(1-this.pitchFactor)}}onAnimationChange(){const e=this.prevColorState,t=this.targetColorScheme;this.material.uniforms.outlineColor.value.lerpColors(e.outerColor,t.outerColor,this.animation.value),this.material.uniforms.baseColor.value.lerpColors(e.innerColor,t.innerColor,this.animation.value),this.opacity=(0,$e.t)(e.opacity,t.opacity,this.animation.value);const i=(0,$e.t)(this.prevRadius,this.targetRadius,this.animation.value);this.setRadius(i)}setPitchFactor(e){super.setPitchFactor(e),this.visible=this.pitchFactor<1}raycast(e,t){const i=[];if(super.raycast(e,i),i.length>0){const s=i[0].point,a=e.ray.origin.distanceTo(this.position),o=(0,qe._U)(a,this.cameraData.pose.projection.asThreeMatrix4(),this.cameraData.width),n=Q.Nh*o;s.distanceTo(this.position)<Q.pp+n&&t.push(i[0])}}updateMaterial(){this.prevRadius=this.material.uniforms.radius.value,this.targetRadius=Q.pp+(this.hoverState.active?Q.XG:0)+(this.selectState.active?Q.XG:0),super.updateMaterial(),this.prevColorState.innerColor.copy(this.material.uniforms.baseColor.value),this.prevColorState.outerColor.copy(this.material.uniforms.outlineColor.value),this.prevColorState.opacity=this.material.opacity,this.animation.modifyAnimation(0,1,Q.rP,fe.hl)}setRadius(e){this.material.uniforms.radius.value=e}updatePosition(e){this.position.copy(e)}}class Xe extends B.RawShaderMaterial{constructor(){super({fragmentShader:ze.fragmentShader,vertexShader:ze.vertexShader,uniforms:B.UniformsUtils.clone(ze.uniforms),name:"OpeningMaterial",depthTest:!1,transparent:!0,stencilFunc:B.AlwaysStencilFunc,stencilWrite:!1})}}const Je=new B.BoxGeometry(1,1,1);class Qe extends Se{constructor(e,t,i){super(e,Je.clone(),new Xe,i),this.floorId=t,this.onEdgePositionChanged=(()=>{const e=new B.Vector3;return(t,i,s,a)=>{e.subVectors(i,t),this.scale.set(e.length(),.05,s),this.stencilPrepass&&this.stencilPrepass.scale.set(e.length(),.05,s);const o=Math.atan2(i.x-t.x,i.z-t.z)+Math.PI/2;this.rotation.y=o,this.stencilPrepass&&(this.stencilPrepass.rotation.y=o);const n=e.addVectors(i,t).multiplyScalar(.5);this.position.copy(n),this.stencilPrepass&&this.stencilPrepass.position.copy(n),this.startHandle.position.copy(t),this.endHandle.position.copy(i);const r=a===K.u.DOOR?1:0;this.material.uniforms.isDoor.value=r,this.stencilPrepass&&(this.stencilPrepass.material.uniforms.isDoor.value=r)}})(),this.renderOrder=se.OPENING_LINES,this.startHandle=new st(e,i,this),this.endHandle=new at(e,i,this),this.animation.onChanged((()=>{this.material.uniforms.baseColor.value.lerpColors(ve.I.WHITE,ve.I.NEPTUNE,this.animation.value)}))}setPitchFactor(e){super.setPitchFactor(e),this.visible=this.pitchFactor<1,this.startHandle.setPitchFactor(e),this.endHandle.setPitchFactor(e),this.stencilPrepass&&this.stencilPrepass.setPitchFactor(e)}updateMaterial(){const e=this.selectState.active||this.hoverState.active||this.highlightState.active;this.animation.modifyAnimation(this.animation.value,e?1:0,Q.rP,fe.hl)}tickAnimations(e){super.tickAnimations(e),this.startHandle.tickAnimations(e),this.endHandle.tickAnimations(e)}}class et extends Qe{constructor(e,t,i){super(e,t,i),this.floorId=t,this.stencilPrepass=new tt(e,t,i)}}class tt extends Qe{constructor(e,t,i){super(e,t,i),this.floorId=t,this.renderOrder=se.OPENING_STENCIL,this.material.colorWrite=!1,this.material.stencilRef=65535,this.material.stencilFuncMask=1<<ae.OPENINGS,this.material.stencilWriteMask=1<<ae.OPENINGS,this.material.stencilFail=B.ReplaceStencilOp,this.material.stencilZFail=B.ReplaceStencilOp,this.material.stencilZPass=B.ReplaceStencilOp,this.material.stencilFunc=B.AlwaysStencilFunc,this.material.stencilWrite=!0}raycast(e,t){}}class it extends Ke{constructor(e,t,i){super(e,t),this.parentOpeningView=i}}class st extends it{}class at extends it{}var ot=i(16782),nt=i(92826);var rt=i(49827),dt=i(27990),lt=i(39880),ct=i(69505);function ht(e,t,i){const s=function(e){return e/180*Math.PI}(t||0);if(!i||0===i[0]&&0===i[1])return ut(e,s);return ut(e.map(((e,t)=>e-i[t])),s).map(((e,t)=>e+i[t]))}function ut(e,t){return[e[0]*Math.cos(t)-e[1]*Math.sin(t),e[0]*Math.sin(t)+e[1]*Math.cos(t)]}function mt(e,t,i){let s=[];for(let a=0,o=e.length;a<o;a++)s[a]=ht(e[a],t,i);return s}var pt=i(65661);class gt extends B.Mesh{constructor(e,t,i){const s=new Float32Array([-1,0,-1,1,1,1,1,0]),a=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]),o=new B.BufferGeometry;o.setAttribute("offset",new B.Float32BufferAttribute(s,2)),o.setAttribute("normal",new B.Float32BufferAttribute(a,3)),o.setIndex([0,3,1,3,2,1]);super(o,new B.RawShaderMaterial({uniforms:B.UniformsUtils.clone(Ge.uniforms),vertexShader:Ge.vertexShader,fragmentShader:Ge.fragmentShader,side:B.FrontSide,transparent:!0,depthTest:!1})),this.updateState(e,t,i),this.renderOrder=se.EDGE,this.frustumCulled=!1,this.onBeforeRender=e=>{e.getSize(this.material.uniforms.screenSize.value)}}updateState(e,t,i){this.material.uniforms.tip.value.copy(e),this.material.uniforms.normal.value.copy(t),this.material.uniforms.height.value=i}updateOpacity(e){this.material.uniforms.opacity.value=e}updateMetersPerPx(e){this.material.uniforms.metersPerPx.value=e}raycast(e){}}const vt={baseState:{innerColor:ve.I.LENS_GRAY,outerColor:ve.I.WHITE,opacity:0},hoverState:{innerColor:ve.I.NEPTUNE,outerColor:ve.I.WHITE,opacity:.5},selectState:{innerColor:ve.I.NEPTUNE,outerColor:ve.I.WHITE,opacity:0},dimState:{innerColor:ve.I.LENS_GRAY,outerColor:ve.I.WHITE,opacity:.5}};class ft extends Se{constructor(e,t,i,s,a){const o=ft.getGeoFromRoom(e,t),n=new B.MeshBasicMaterial({color:ve.I.LENS_GRAY,depthTest:!1,side:B.DoubleSide,transparent:!0,opacity:0,blending:B.CustomBlending,blendEquation:B.AddEquation,blendSrc:B.SrcAlphaFactor,blendDst:B.DstColorFactor,stencilRef:65535,stencilFuncMask:1<<ae.EDGE,stencilFail:B.KeepStencilOp,stencilZFail:B.KeepStencilOp,stencilZPass:B.KeepStencilOp,stencilFunc:B.GreaterStencilFunc,stencilWrite:!0});super(e.id,o,n,i),this.baseHeight=t,this.labelManager=s,this.units=a,this.perimeterLabels=[],this.dimensionCarets=[new gt(new B.Vector2,new B.Vector2,0),new gt(new B.Vector2,new B.Vector2,0),new gt(new B.Vector2,new B.Vector2,0),new gt(new B.Vector2,new B.Vector2,0)],this.hideMaterial=new B.RawShaderMaterial({vertexShader:je.vertexShader,fragmentShader:je.fragmentShader,uniforms:B.UniformsUtils.clone(je.uniforms),depthTest:!1,side:B.DoubleSide,transparent:!0}),this.perimeterLabelsVisible=!1,this.fullLabelVisible=!1,this.hoverTimer=null,this.willHover=!1,this.getLabelPolygon=(()=>{const e=new B.Vector3,t=[0,0],i=[t,[0,0],[0,0],[0,0],t];return(t,s)=>{const a=this.cameraData.pose.position.distanceTo(s),o=(0,qe._U)(a,this.cameraData.pose.projection.asThreeMatrix4(),this.cameraData.width),n=t.split("\n"),r=n.reduce(((e,t)=>Math.max(e,t.length)),0),d=(0,dt.hJ)(r,0,0),l=s.x,c=s.z,h=.5*d.width*o,u=.5*d.height*o*n.length;return e.set(l-h,0,c-u),e.applyQuaternion(this.cameraData.pose.rotation),i[0][0]=l-h,i[0][1]=c-u,i[1][0]=l+h,i[1][1]=c-u,i[2][0]=l+h,i[2][1]=c+u,i[3][0]=l-h,i[3][1]=c+u,i}})(),this.standardMaterial=n,this.renderOrder=se.ROOM,this.roomLabel=this.labelManager.createRoomLabel(e.floorId,e.id),this.roomLabel.addTo(this),this.roomLabel.setVisible(!e.hide),this.room=e;for(const e of this.dimensionCarets)this.add(e);this.updateLabel(!0),this.colors=vt,this.animation.onChanged((()=>{const e=this.prevColorState;this.standardMaterial.color.lerpColors(e.innerColor,this.targetColorScheme.innerColor,this.animation.value);const t=(0,$e.t)(e.opacity,this.targetColorScheme.opacity,this.animation.value);this.opacity=t,this.hideMaterial.uniforms.opacity.value=this.roomLabel.label.opacity})),this.onBeforeRender=()=>{this.standardMaterial.opacity=this.opacity*(1-this.pitchFactor);const e=this.dimState.active?.5:1;for(const t of this.dimensionCarets)t.updateMetersPerPx(i.metersPerPx()),t.updateOpacity((1-this.pitchFactor)*e)}}dispose(){this.labelManager.deleteLabel(this.roomLabel);for(const e of this.perimeterLabels)this.labelManager.deleteLabel(e),e.dispose();this.clearHoverTimer(),super.dispose()}hoverRoomLabel(e){const t=()=>{if(!e&&this.roomLabel.getHovered()===e||e&&this.fullLabelVisible)return;this.roomLabel.setHovered(e),this.updateMaterial();this.roomLabel.label.collider.material.opacity=e?1:0,this.updateLabel(!1),this.updateCarets()};this.willHover=e,this.setLabelVisible(e&&(0,W.Eb)(this.pitchFactor)),e?null===this.hoverTimer&&(this.hoverTimer=window.setTimeout(t,Q.qb),this.updateMaterial()):(t(),this.clearHoverTimer())}updateGeo(e,t,i){this.room=e,this.baseHeight=t;const s=ft.getGeoFromRoom(e,t);this.geometry.dispose(),this.geometry=s,this.geometry.computeBoundingBox(),this.updateLabel(!1),this.units=i,this.perimeterLabelsVisible&&this.updatePerimeterLabels()}updateLabelBillboard(){const{position:e,rotation:t,projection:i}=this.cameraData.pose,{height:s}=this.cameraData,a=this.cameraData.isOrtho()?this.cameraData.zoom():1,o=this.cameraData.aspect();this.roomLabel.label.quaternion.copy(t),this.roomLabel.label.scaleBillboard(e,t,i,a,s,o,.1),this.updateLabel(!1);for(const e of this.perimeterLabels)e.update();this.updateMaterial(),this.updateCarets()}setLabelVisible(e){this.perimeterLabelsVisible=e,e&&this.updatePerimeterLabels();for(const t of this.perimeterLabels)t.setVisible(e);this.updateCarets()}updateMaterial(){this.material=this.room.hide?this.hideMaterial:this.standardMaterial,super.updateMaterial();const e=this.hoverState.active||this.willHover;e&&(this.targetColorScheme=this.colors.hoverState),this.standardMaterial.blending=e?B.CustomBlending:B.NormalBlending;const t=this.standardMaterial;this.prevColorState.innerColor.copy(t.color),this.prevColorState.opacity=t.opacity,this.animation.modifyAnimation(0,1,Q.rP,fe.hl),this.roomLabel.setDimmed(this.dimState.active),this.roomLabel.setVisible(!this.room.hide||e)}updateText(e,t,i,s){this.labelText=e,this.areaText=t,this.dimensionText=i,this.updateLabel(s),this.updateCarets()}static getGeoFromRoom(e,t){const{points:i,faces:s}=e.getGeometry(),a=i.map((e=>[e.x,t,e.y])).flat(1),o=new B.BufferGeometry;return o.setAttribute("position",new B.BufferAttribute(new Float32Array(a),3)),o.setIndex(s.flat(1)),o}updateLabel(e){if(!this.areaText||!this.labelText)return;const t=this.room.points.map((e=>[e.x,e.z]));t.push(t[0]);const i=(new B.Euler).setFromQuaternion(this.cameraData.pose.rotation).z,s=ct.MN*i,a=this.areaText.length>0&&!this.room.hide?"\n"+this.areaText:"",o=this.dimensionText.length>0&&!this.room.hide?"\n"+this.dimensionText:"",n=[];for(let e=this.labelText.length;e>=0;e--)n.push((0,lt.aS)(this.labelText,e)+a+o,(0,lt.aS)(this.labelText,e)+a);for(let e=this.labelText.length;e>=0;e--)n.push((0,lt.aS)(this.labelText,e));n.push("...");const r=[];e||r.push(this.roomLabel.label.position.clone()),r.push(this.room.getViewCenter());for(const e of r){this.roomLabel.label.position.copy(e),this.roomLabel.label.position.y=this.baseHeight;let i=!1;this.fullLabelVisible=!0;for(const a of n){const o=mt(this.getLabelPolygon(a,e),-s,[e.x,e.z]);if((0,pt.D)(o,t)||this.roomLabel.getHovered()){this.roomLabel.label.text=a,i=!0;break}this.fullLabelVisible=!1}if(i)break}}updatePerimeterLabels(){const e=this.room.hide?[]:this.room.minimalInnerLoop;for(;e.length>this.perimeterLabels.length;)this.perimeterLabels.push(this.labelManager.createPerimeterLabel(this.room.floorId).addTo(this));for(;e.length<this.perimeterLabels.length;){const e=this.perimeterLabels.pop();if(!e)throw new Error("Label should exist!");this.labelManager.deleteLabel(e)}for(let t=0;t<e.length;t++){const i=e[t];this.perimeterLabels[t].updateDimensions(i.start.clone(),i.end.clone(),0,this.units)}}updateCarets(){const e=this.cameraData.metersPerPx(),t=this.room.length/e,i=this.room.width/e,s=this.roomLabel.getSize(),a=s.width+2>t,o=s.height+2>i,n=this.fullLabelVisible&&(a||o);if(!this.room.canDisplayDimensions()||this.perimeterLabelsVisible||!this.fullLabelVisible||n)for(const e of this.dimensionCarets)e.visible=!1;else{const e=new B.Vector2;e.subVectors(this.room.w2,this.room.w1).normalize(),this.dimensionCarets[0].updateState(this.room.w1,e,this.baseHeight),this.dimensionCarets[0].visible=!0,e.subVectors(this.room.w1,this.room.w2).normalize(),this.dimensionCarets[1].updateState(this.room.w2,e,this.baseHeight),this.dimensionCarets[1].visible=!0,e.subVectors(this.room.l2,this.room.l1).normalize(),this.dimensionCarets[2].updateState(this.room.l1,e,this.baseHeight),this.dimensionCarets[2].visible=!0,e.subVectors(this.room.l1,this.room.l2).normalize(),this.dimensionCarets[3].updateState(this.room.l2,e,this.baseHeight),this.dimensionCarets[3].visible=!0}}clearHoverTimer(){null!==this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=null)}}var wt,yt=i(61011),St=i(10840);!function(e){e[e.PIXELS=0]="PIXELS",e[e.METERS=1]="METERS"}(wt||(wt={}));class bt extends B.Mesh{constructor(e,t,i){const s=new Float32Array([-9999,-9999,-9999,9999,9999,9999,-9999,-9999,-9999,9999,9999,9999,9999,9999,9999,-9999,-9999,-9999]),a=new Float32Array([1,1,0,0,-1,-1]),o=new Float32Array([0,1,0,1,0,1]),n=new B.BufferGeometry;n.setAttribute("position",new B.Float32BufferAttribute(s,3)),n.setAttribute("offsetDirection",new B.Float32BufferAttribute(a,1)),n.setAttribute("t",new B.Float32BufferAttribute(o,1)),n.setIndex([0,2,1,2,3,1,2,4,3,4,5,3]);let r={},d={};(null==i?void 0:i.dashUnits)===wt.METERS&&(r={WORLDSPACE_DASH:!0},d={derivatives:!0});super(n,new B.RawShaderMaterial({uniforms:B.UniformsUtils.clone(St.T.screenline.uniforms),side:B.FrontSide,vertexShader:St.T.screenline.vertexShader,fragmentShader:St.T.screenline.fragmentShader,transparent:!0,depthTest:i.depthTest,depthWrite:i.depthWrite,depthFunc:i.depthFunc,defines:r,extensions:d})),this.updateEndpoints(e,t),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.renderOrder=we.z.lines,this.onBeforeRender=e=>{e.getSize(this.material.uniforms.screenSize.value)},this.material.uniforms.dashed.value=+i.dashed,this.material.uniforms.dashSize.value=i.dashSize,this.material.uniforms.gapSize.value=i.gapSize,this.material.uniforms.lineWidth.value=i.lineWidth,this.material.uniforms.color.value.copy(i.color),this.material.uniforms.opacity.value=i.opacity}updateEndpoints(e,t){this.material.uniforms.start.value.copy(e),this.material.uniforms.end.value.copy(t)}opacity(e){this.material.uniforms.opacity.value=e}color(e){this.material.uniforms.color.value.copy(e)}}const Et={baseState:{innerColor:ve.I.WHITE,outerColor:ve.I.WHITE,opacity:1},hoverState:{innerColor:ve.I.WHITE,outerColor:ve.I.NEPTUNE,opacity:1},selectState:{innerColor:ve.I.WHITE,outerColor:ve.I.NEPTUNE,opacity:1},dimState:{innerColor:ve.I.WHITE,outerColor:ve.I.WHITE,opacity:.5}};class Dt extends Se{constructor(e,t,i){const s=new Float32Array([0,0,0,1,0,0,1,0,1,0,0,1,-1,0,1,-1,0,0,1,0,2,-1,0,2,-1,0,-1,1,0,-1]),a=new B.BufferGeometry;a.setAttribute("position",new B.Float32BufferAttribute(s,3)),a.setIndex([0,1,2,0,2,3,0,3,4,0,4,5,3,2,6,3,7,4,0,9,1,0,5,8]);const o=new B.RawShaderMaterial({uniforms:B.UniformsUtils.clone(Ue.uniforms),vertexShader:Ue.vertexShader,fragmentShader:Ue.fragmentShader,transparent:!0,depthTest:!1,stencilRef:65535,stencilFuncMask:1<<ae.OPENINGS,stencilFail:B.KeepStencilOp,stencilZFail:B.KeepStencilOp,stencilZPass:B.KeepStencilOp,stencilFunc:B.GreaterStencilFunc,stencilWrite:!0,extensions:{derivatives:!0}});super(e,a,o,t),this.lineLabel=i,this.line3=new B.Line3(new B.Vector3,new B.Vector3),this.widthCache=.1,this.updateMaterial=()=>{super.updateMaterial();const e=this.material.uniforms;this.prevColorState.innerColor.copy(e.color.value),this.prevColorState.outerColor.copy(e.outlineColor.value),this.prevColorState.opacity=e.opacity.value;const t=this.selectState.active||this.highlightState.active,i=this.hoverState.active;this.renderOrder=t||i?se.HIGHLIGHTED_EDGE:se.EDGE,this.animation.modifyAnimation(0,1,Q.rP,fe.hl)},this.raycast=(()=>{const e=new B.Vector3,t=new B.Vector2,i=new B.Vector2;return(s,a)=>{const o=this.line3.closestPointToPoint(s.ray.origin,!0,e);t.set(o.x,o.z),i.set(s.ray.origin.x,s.ray.origin.z);const n=t.distanceTo(i),r=s.ray.origin.distanceTo(this.line3.start),d=(0,qe._U)(r,this.cameraData.pose.projection.asThreeMatrix4(),this.cameraData.width),l=Q.Nh*d;n<.5*this.widthCache+l&&a.push({distance:r,object:this,point:o.clone(),face:{a:-1,b:-1,c:-1,materialIndex:-1,normal:new B.Vector3(0,1,0)}})}})(),this.onEdgePositionChanged=(()=>{const e=new B.Vector3,t=new B.Vector3,i=new B.Vector3,s=new B.Vector3,a=new B.Vector3,o=new B.Vector3,n=new B.Vector3;return(r,d,l)=>{var c;const h=r.getWall(this.roomBoundsId),u=(null===(c=d.floors.getFloor(h.floorId))||void 0===c?void 0:c.bottom)||0;h.from.getVec3(e),h.to.getVec3(t);const m=this.geometry.getAttribute("position");h.getBiasAdjustmentVec(n),i.set(e.x,e.y+u,e.z),s.set(t.x,t.y+u,t.z),a.addVectors(i,n),o.addVectors(s,n),this.line3.start.copy(a),this.line3.end.copy(o),this.material.uniforms.lineStart.value.copy(a),this.material.uniforms.lineEnd.value.copy(o),this.material.uniforms.width.value=h.width,this.stencilMat.uniforms.lineStart.value.copy(a),this.stencilMat.uniforms.lineEnd.value.copy(o),this.stencilMat.uniforms.width.value=h.width,this.widthCache=h.width,this.lineLabel.updateDimensions(a,o,h.width,l),m.setXYZ(0,i.x,i.y,i.z),m.setXYZ(3,s.x,s.y,s.z);const{fromLeft:p,fromRight:g,toLeft:v,toRight:f}=(0,yt.b)(h,r);m.setXYZ(1,g.primary.x,g.primary.y+u,g.primary.z),m.setXYZ(2,f.primary.x,f.primary.y+u,f.primary.z),m.setXYZ(4,v.primary.x,v.primary.y+u,v.primary.z),m.setXYZ(5,p.primary.x,p.primary.y+u,p.primary.z),m.setXYZ(9,g.bevel.x,g.bevel.y+u,g.bevel.z),m.setXYZ(6,f.bevel.x,f.bevel.y+u,f.bevel.z),m.setXYZ(7,v.bevel.x,v.bevel.y+u,v.bevel.z),m.setXYZ(8,p.bevel.x,p.bevel.y+u,p.bevel.z),m.needsUpdate=!0,this.perspectiveLine.updateEndpoints(i,s),this.occlusionLine.updateEndpoints(i,s),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()}})(),this.renderOrder=se.EDGE,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere();const n={dashed:!1,dashSize:1,gapSize:1,lineWidth:1,color:ve.I.WHITE,dashUnits:wt.METERS,depthWrite:!1,depthTest:!0,depthFunc:B.LessDepth,opacity:1},r={dashed:!0,dashSize:.08,gapSize:.04,lineWidth:1,color:ve.I.WHITE,dashUnits:wt.METERS,depthWrite:!1,depthTest:!0,depthFunc:B.GreaterDepth,opacity:1};this.occlusionLine=new bt(new B.Vector3,new B.Vector3,r),this.perspectiveLine=new bt(new B.Vector3,new B.Vector3,n),this.add(this.perspectiveLine),this.add(this.occlusionLine),this.colors=Et,this.material.uniforms.selectedWidth.value=.03;const d=o.clone();d.stencilRef=65535,d.stencilFuncMask=1<<ae.OPENINGS,d.stencilWriteMask=1<<ae.EDGE,d.stencilFail=B.KeepStencilOp,d.stencilZFail=B.KeepStencilOp,d.stencilZPass=B.ReplaceStencilOp,d.stencilFunc=B.AlwaysStencilFunc,d.stencilWrite=!0,d.colorWrite=!1,this.stencilMat=d;const l=new B.Mesh(this.geometry,this.stencilMat);l.renderOrder=se.EDGE_STENCIL,this.stencilMesh=l;const c=ve.I.WHITE.clone();this.animation.onChanged((()=>{const e=this.prevColorState,t=this.targetColorScheme;this.material.uniforms.outlineColor.value.lerpColors(e.outerColor,t.outerColor,this.animation.value);this.material.uniforms.color.value.lerpColors(e.innerColor,t.innerColor,this.animation.value);const i=(0,$e.t)(e.opacity,t.opacity,this.animation.value);this.opacity=i,c.copy(ve.I.WHITE).multiplyScalar(this.opacity),this.occlusionLine.color(c),this.perspectiveLine.color(c)})),this.onBeforeRender=()=>{this.material.depthTest=1===this.pitchFactor,this.material.uniforms.opacity.value=(1-this.pitchFactor)*this.opacity,this.occlusionLine.opacity(this.pitchFactor),this.perspectiveLine.opacity(this.pitchFactor),this.lineLabel.update()}}tickAnimations(e){super.tickAnimations(e),this.lineLabel.tickAnimations(e)}setLabelVisible(e){this.lineLabel.setVisible(e)}dispose(){super.dispose(),this.lineLabel.dispose()}}const It=new C.Z("room-bounds-editor"),Ct=e=>{const t=It.debug;return(0,te.k1)((()=>t(`${e}.renew()`)),(()=>t(`${e}.cancel()`)),!1)};class Ot extends R.DragAndDrop{constructor(e,t,i,s,a,o,n,r,d){super(new J),this.getCursorOrigin=e,this.input=t,this.raycaster=i,this.messageBus=s,this.data=a,this.floorsViewData=o,this.cameraPoseData=n,this.commandBinder=r,this.clearSelectionIfNeeded=e=>{this.state.currentId===e.id&&this.deselect()},this.allViewsComparator=ge.s.is((e=>this.state.toolState===R.ToolState.READ_ONLY||this.state.toolState===R.ToolState.SELECTED_READ_ONLY?e instanceof ft:e instanceof Se)),this.draggableViewsComparator=ge.s.is((e=>(e instanceof Dt||e instanceof et||e instanceof Ke)&&!!e.raycastEnabled)),this.addPoint=e=>{if(e.button!==ot.M.PRIMARY)return;const t=this.getCurrentRoomBoundHit(),i=this.getCursorOrigin(),s={x:i.x,z:i.z};switch(this.data.finalizeHistory(),this.state.addType){case q.WALLS:{const{wallType:e}=this.state,a=this.data.getLastWallWidth(e);if(t)if(t instanceof k.z){const{wall:i}=this.data.addTrailingEdgeToNode(e,t.id,s,a);this.add(i)}else if(t instanceof F.c){const o=t.getProjection(i),{newTrailingWall:n}=this.data.addTrailingEdgeToEdge(e,t.id,o,s,a);this.add(n.id)}else{if(!(t instanceof X.JJ||t instanceof K.E))throw new Error("Trying to add a new Edge on an invalid object type");this.addFirstFloatingPoint(s)}else this.addFirstFloatingPoint(s)}break;case q.DOORS:case q.OPENINGS:{const e=this.state.tempHoverPreviewEntityId;e&&(this.data.finalizeHistory(),setTimeout((()=>this.select(e)),1),this.state.tempHoverPreviewEntityId=null)}}},this.moveTemporaryPreview=()=>{const e=new B.Line3;return(()=>{const t=this.state.tempHoverPreviewEntityId;if(t){if(this.state.addType!==q.DOORS&&this.state.addType!==q.OPENINGS)return void this.deleteTemporaryPreview();const i=this.data.getOpening(t),s=this.data.getWall(i.wallId).getLine3(e),a=this.getCursorOrigin(),o=s.closestPointToPointParameter(a,!0),n=i.width/s.distance()*.5;o+n<1&&o-n>0&&this.data.editWallOpeningDetails(t,{relativePos:o})}})()},this.mergePointAndStartNewWall=e=>{this.tryCommit()},this.updateCursor=()=>{const{toolState:e,pendingValid:t,pendingAdd:i,pendingEdit:s,currentId:a}=this.state;let o=g.C.ROOMBOUNDS_DEFAULT;if((e===R.ToolState.ADDING||e===R.ToolState.WAIT_FOR_ADD)&&a){o=g.C.ROOMBOUNDS_PLACE_NODE;const t=e===R.ToolState.ADDING?this.data.getWall(a).to.id:a;if(t)try{const e=((e,t,i,s=!1)=>{const a=t.getAttachedEntities(e),o=s?e.getVec3():void 0;return i.getCurrentRoomBoundHit(a,o)})(this.data.getNode(t),this.data,this);e&&(e instanceof F.c||e instanceof k.z)&&(o=g.C.ROOMBOUNDS_FINISH_ROOM)}catch(e){}}this.state.dragging&&(o=g.C.ROOMBOUNDS_MOVING),(i||s)&&!1===t&&(o=g.C.NOPE),this.state.cursor!==o&&(this.state.cursor=o,this.state.commit())};const l=[this.subscribe(R.Events.StateChange,(async({target:e})=>{this.inputStates||(this.inputStates=this.bindInputToEditorStates(d)),this.inputStates.cancel(),this.inputStates.renew(e)})),this.subscribe(R.Events.CurrentChange,this.updateCursor),this.subscribe(R.Events.ValidChange,this.updateCursor),this.subscribe(R.Events.HoverChange,this.updateCursor),this.input.registerHandler(oe.mE,this.updateCursor),this.data.onNodesChanged({onRemoved:this.clearSelectionIfNeeded}),this.data.onWallsChanged({onRemoved:this.clearSelectionIfNeeded}),this.data.onOpeningsChanged({onRemoved:this.clearSelectionIfNeeded}),this.data.onRoomsChanged({onRemoved:this.clearSelectionIfNeeded})];l.forEach((e=>e.cancel())),this.bindings.push(...l)}exit(){super.exit(),this.inputStates&&this.inputStates.cancel()}bindInputToEditorStates(e){const t=new D.V(this.input.registerPriorityHandler(ne._t,he.S,(()=>!0)),this.input.registerPriorityHandler(ne._t,me.i,(()=>!0)));t.cancel();const i=()=>this.setEnabled(!1),s=()=>this.setEnabled(!0),a=new D.V((0,te.k1)((()=>this.messageBus.subscribe(pe.oR,i)),(()=>this.messageBus.unsubscribe(pe.oR,i)),!1),(0,te.k1)((()=>this.messageBus.subscribe(pe.NR,s)),(()=>this.messageBus.unsubscribe(pe.NR,s)),!1),this.cameraPoseData.onChanged((()=>{this.state.toolState!==R.ToolState.CLOSED&&this.setEnabled(this.cameraPoseData.pitchFactor()<1)}))),o=new D.V(this.input.registerUnfilteredHandler(re.e,(e=>{e.key===Z.R.ESCAPE&&this.discard(),e.key===Z.R.RETURN&&this.tryCommit()})));o.cancel();const n=new nt.r(e,"keydown",(e=>{"KeyZ"===e.code&&(e.ctrlKey||e.metaKey)&&this.commandBinder.issueCommand(new P.o3)}));n.cancel();const r=new D.V(this.input.registerMeshHandler(de.z,this.allViewsComparator,((e,t)=>this.hover(t.roomBoundsId,t))),this.input.registerMeshHandler(de.A,this.allViewsComparator,(()=>this.unhover())));r.cancel();const d=this.input.registerUnfilteredHandler(re.e,(e=>{e.key===Z.R.ESCAPE&&this.deselect()}));d.cancel();const l=this.input.registerUnfilteredHandler(re.e,(e=>{const t=[Z.R.DELETE,Z.R.BACKSPACE].includes(e.key);if(this.state.pendingEdit&&t){const{currentId:e}=this.state;e&&(this.discard(),this.data.deleteEntity(e),this.data.finalizeHistory())}}));l.cancel();const c=new D.V(this.input.registerPriorityHandler(le.R,he.S,(()=>(this.deselect(),!0))),this.input.registerPriorityHandler(le.R,me.i,(()=>(this.deselect(),!0))));c.cancel();const h=new D.V(this.input.registerMeshHandler(le.R,this.allViewsComparator,this.onToggleSelectInput.bind(this)),this.input.registerMeshHandler(ne.u4,this.allViewsComparator,this.onToggleSelectInput.bind(this)),this.input.registerMeshHandler(ne._t,this.draggableViewsComparator,this.onToggleSelectInput.bind(this)));h.cancel();const u=this.input.registerUnfilteredHandler(le.R,this.addPoint),m=this.input.registerUnfilteredHandler(le.R,this.mergePointAndStartNewWall),p=new D.V(this.input.registerMeshHandler(ne.u4,this.draggableViewsComparator,this.placeOnDrag.bind(this)),this.input.registerMeshHandler(ne.Zv,this.draggableViewsComparator,this.onDragEnd.bind(this)));p.cancel();const g=this.input.registerUnfilteredHandler(oe.mE,(e=>this.move(e)));g.cancel();const v=this.input.registerUnfilteredHandler(oe.er,this.dropOnPointerUp.bind(this));v.cancel();const f=this.input.registerUnfilteredHandler(oe.mE,this.moveTemporaryPreview.bind(this));f.cancel();const w=this.input.registerUnfilteredHandler(oe.er,(e=>{e.button===ot.M.PRIMARY&&this.updateCursor()})),y=(0,te.k1)((()=>{this.commandBinder.issueCommand(new ue.ZK),this.commandBinder.issueCommand(new ce.t)}),(()=>{this.commandBinder.issueCommand(new ue.Lp),this.commandBinder.issueCommand(new ce.U)}),!1),S=new D.V(a,r,h,Ct("ToolState.READ_ONLY -> bindings")),b=new D.V(a,r,h,p,w,n,Ct("ToolState.IDLE -> bindings")),E=new D.V(a,o,r,f,u,y,Ct("ToolState.WAIT_FOR_ADD -> bindings")),I=new D.V(a,o,g,r,m,y,n,Ct("ToolState.ADDING -> bindings")),C=[a,h,r,w,d,c],O=[p,n,l],A=new D.V(...C,...O,Ct("ToolState.SELECTED -> bindings")),x=new D.V(...C,Ct("ToolState.SELECTED_READ_ONLY -> bindings")),M=new D.V(a,t,o,r,Ct("ToolState.PLACING -> (base) bindings")),T=new D.V(...C,...O,Ct("ToolState.EDITING -> bindings"));return new ie([{state:R.ToolState.DISABLED,subs:[a]},{state:R.ToolState.READ_ONLY,subs:[S]},{state:R.ToolState.IDLE,subs:[b]},{state:R.ToolState.WAIT_FOR_ADD,subs:[E]},{state:R.ToolState.ADDING,subs:[I]},{state:R.ToolState.SELECTED,subs:[A]},{state:R.ToolState.SELECTED_READ_ONLY,subs:[x]},{state:R.ToolState.EDITING,subs:[T]},{state:R.ToolState.PLACING,subs:[M,g,v]}])}getCurrentRoomBoundHit(e,t){let i;const s=e=>e instanceof Se,a=e=>s(e.object);if(null==t)i=this.input.getCurrentRayHits().filter(a);else{const e=t.clone().add(new B.Vector3(0,1e3,0));i=this.raycaster.picking.cast(e,L.fU.DOWN,s)}let o=i.filter(a).map((e=>e.object.roomBoundsId));return e&&(o=o.filter((t=>!e.has(t)))),o.length>0?this.data.getEntity(o[0]):null}onToggleSelectInput(e,t){this.updateOpeningEditState(t);const i=t.roomBoundsId;i&&setTimeout((()=>{if(t.parent){if(this.state.selected===i)e instanceof le.R&&(this.discard(),this.deselect());else{const e=this.state.toolState;e!==R.ToolState.EDITING&&e!==R.ToolState.PLACING||this.discard(),this.select(i),e!==R.ToolState.READ_ONLY&&e!==R.ToolState.SELECTED_READ_ONLY&&this.edit(i),this.hover(i)}}}),0)}hover(e,t){super.hover(e),t&&this.handleOpeningHover(t),this.state.tempHoverPreviewEntityId&&this.state.tempHoverPreviewEntityId!==e&&this.deleteTemporaryPreview();const i=this.state.toolState===R.ToolState.ADDING||this.state.toolState===R.ToolState.WAIT_FOR_ADD,s=this.state.addType===q.DOORS||this.state.addType===q.OPENINGS;if(i&&s){const e=this.getCurrentRoomBoundHit(),t=this.getCursorOrigin(),i=this.addOpeningOrDoor(e,t);i&&(this.state.tempHoverPreviewEntityId=i)}}handleOpeningHover(e){const t=e=>{e.hoverState.active=!1,e.hoverState.off()};if(e instanceof et)t(e.startHandle),t(e.endHandle);else if(e instanceof it){t(e instanceof st?e.parentOpeningView.endHandle:e.parentOpeningView.startHandle)}}placeOnDrag(e,t){if(e instanceof ne._t&&e.buttons!==ot.r.PRIMARY||e instanceof ne.u4&&e.pointer.buttons!==ot.r.PRIMARY)return;this.updateOpeningEditState(t);const i=t.roomBoundsId;this.state.selected!==i&&this.select(i),this.place(i),this.state.dragging=!0}onDragEnd(e){this.state.dragging=!1}updateOpeningEditState(e){this.state.openingEditState=e instanceof st?Y.START:e instanceof at?Y.END:Y.MOVE}dropOnPointerUp(e){if(e.down)this.updateCursor();else{!1!==this.state.pendingValid?this.tryCommit():this.discard()}}addOpeningOrDoor(e,t){if(!(e instanceof F.c))return null;const i=e.getProjection(t)/e.length,s=Math.min(.9*e.length,.9144),a=s/e.length*.5,o=(0,rt.uZ)(i,a,1-a);return this.data.addWallOpening({wallId:e.id,type:this.state.addType===q.DOORS?K.u.DOOR:K.u.OPENING,relativePos:o,width:s})}deleteTemporaryPreview(){this.state.tempHoverPreviewEntityId&&this.data.tryGetEntity(this.state.tempHoverPreviewEntityId)&&(this.data.deleteEntity(this.state.tempHoverPreviewEntityId),this.state.tempHoverPreviewEntityId=null)}addFirstFloatingPoint(e){if(!this.floorsViewData.currentFloorId)throw new Error("Expected a floor when adding point.");const{wall:t}=this.data.addFloatingEdge(this.state.wallType,e,Object.assign({},e),this.data.getLastWallWidth(this.state.wallType),this.floorsViewData.currentFloorId);this.add(t)}}var At=i(26158),xt=i(69739),Mt=i(56159),Rt=i(46391),Tt=i(84784);class Vt extends Ke{}var Nt,Pt=i(82582),Lt=i.n(Pt),Ft=i(67971),kt=i(37519),Bt=i(72119);class Wt{constructor(){this.corner=[new B.Vector2,new B.Vector2,new B.Vector2,new B.Vector2],this.axis=[new B.Vector2,new B.Vector2],this.origin=[0,0],this.aabb=new B.Box2}set(e){if(4!==e.length)throw new Error("Obb needs four points!");for(let t=0;t<e.length;t++)this.corner[t].copy(e[t]);this.aabb.setFromPoints(this.corner),this.axis[0].subVectors(this.corner[1],this.corner[0]),this.axis[1].subVectors(this.corner[3],this.corner[0]);for(let e=0;e<2;e++)this.axis[e].divideScalar(this.axis[e].lengthSq()),this.origin[e]=this.corner[0].dot(this.axis[e])}overlaps(e){return this.overlaps1Way(e)&&e.overlaps1Way(this)}overlaps1Way(e){for(let t=0;t<2;t++){let i=e.corner[0].dot(this.axis[t]),s=i,a=i;for(let o=1;o<4;o++)i=e.corner[o].dot(this.axis[t]),s=Math.min(s,i),a=Math.max(a,i);if(s>1+this.origin[t]||a<this.origin[t])return!1}return!0}}class Ht{constructor(e,t,i,s,a){this.cameraData=i,this.getCurrFloorId=s,this.debugContainer=a,this.labels=new Set,this.tree=new(Lt()),this.roomLabelMaker=new Ft.uc({assetBasePath:e,lang:t,color:"white",outline:!0,background:!1,backgroundColor:"#000000",backgroundColliderType:jt,disableDepth:!0}),this.wallLabelMaker=new Ft.uc({assetBasePath:e,color:"black",lang:t,background:!0,backgroundColor:"#ffffff",backgroundColliderType:zt,disableDepth:!0})}createRoomLabel(e,t){const i=new _t(Nt.ROOM,e,this.roomLabelMaker.createLabel());return i.label.collider.userData={roomId:t},this.labels.add(i),i}createWallLabel(e){const t=new Ut(Nt.WALL,e,this.wallLabelMaker.createLabel(),this.cameraData);return this.labels.add(t),t}createPerimeterLabel(e){const t=new Ut(Nt.PERIMETER,e,this.wallLabelMaker.createLabel(),this.cameraData);return this.labels.add(t),this.update(),t}deleteLabel(e){e.label.parent&&e.removeFrom(e.label.parent),this.labels.delete(e),e.dispose()}tickAnimations(e){for(const t of this.labels)t.tickAnimations(e)}update(){const e=new B.Vector2,t=new B.Vector3,i=new B.Vector3,s=[{x:-1,y:-1,screenPos:new B.Vector2},{x:1,y:-1,screenPos:new B.Vector2},{x:1,y:1,screenPos:new B.Vector2},{x:-1,y:1,screenPos:new B.Vector2}],a=[];this.debugContainer&&this.debugContainer.clear();const o=(0,qe.Pp)(this.cameraData.pose.projection),n=this.getCurrFloorId(),r=Array.from(this.labels).filter((e=>e.labelVisible&&n&&n===e.floorId)).sort(((e,t)=>{const i=Number(!e.getHovered())-Number(!t.getHovered());if(0!==i)return i;const s=e.type-t.type;if(0!==s)return s;const a=t.length-e.length;return 0!==a?a:e.label.id-t.label.id})).map((n=>{const r=n.label,d=o?Math.abs(r.position.y-this.cameraData.pose.position.y):this.cameraData.pose.position.distanceTo(r.position),l=(0,qe._U)(d,this.cameraData.pose.projection.asThreeMatrix4(),this.cameraData.width)*Q.bk;(0,W.q9)(this.cameraData,r.position,e,t);const{width:c,height:h}=r.getUnscaledSize();this.debugContainer&&(a.length=0),r.updateMatrixWorld();for(const e of s)i.set(c*e.x*.5+l*e.x,h*e.y*.5+(l+e.y),0),i.applyMatrix4(r.matrixWorld),this.debugContainer&&a.push(i.clone()),(0,W.q9)(this.cameraData,i,e.screenPos);if(this.debugContainer){const e=new B.Mesh(new B.ShapeGeometry(new B.Shape(a.map((e=>new B.Vector2(e.x,e.z))))).rotateX(Math.PI/2),new B.MeshBasicMaterial({color:"red",depthTest:!1,side:B.DoubleSide}));this.debugContainer.add(e)}const u=new Wt;u.set(s.map((e=>e.screenPos)));const m=u.aabb;return{label:n,oob:u,minX:m.min.x,minY:m.min.y,maxX:m.max.x,maxY:m.max.y}}));let d="";for(const e of r){d!==e.label.floorId&&(this.tree.clear(),d=e.label.floorId);const t=this.tree.search(e).find((t=>t.oob.overlaps(e.oob)));e.label.setCollides(!!t),t||this.tree.insert(e)}for(const e of this.labels)e.update()}}!function(e){e[e.ROOM=0]="ROOM",e[e.WALL=1]="WALL",e[e.PERIMETER=2]="PERIMETER"}(Nt||(Nt={}));class _t{constructor(e,t,i){this.type=e,this.floorId=t,this.label=i,this.length=0,this.labelOpacityAnimation=new ye.z(1),this.labelVisible=!1,this.collides=!1,this.dimmed=!1,this.hovered=!1,this.label.setRenderOrder(we.z.labels),this.updateOpacityTarget(0)}addTo(e){return e.add(this.label),this}removeFrom(e){e.remove(this.label)}dispose(){this.label.dispose()}tickAnimations(e){this.labelOpacityAnimation.tick(e)}setVisible(e){e!==this.labelVisible&&(this.labelVisible=e,this.updateOpacityTarget())}setCollides(e){e!==this.collides&&(this.collides=e,this.updateOpacityTarget(e?0:Q.rP))}setDimmed(e){e!==this.dimmed&&(this.dimmed=e,this.updateOpacityTarget())}setHovered(e){this.hovered=e,this.updateOpacityTarget()}getHovered(){return this.hovered}update(){this.updateOpacity()}getSize(){const e=this.label.text.split("\n"),t=e.reduce(((e,t)=>Math.max(e,t.length)),0),i=(0,dt.hJ)(t,0,0);return{width:i.width,height:i.height*e.length}}updateOpacity(){this.label.opacity=this.labelOpacityAnimation.value}updateOpacityTarget(e=Q.rP){const t=this.dimmed&&!this.hovered?.5:1,i=this.labelVisible&&!this.collides?t:0;this.labelOpacityAnimation.modifyAnimation(e>0?this.labelOpacityAnimation.value:i,i,e)}}class Ut extends _t{constructor(e,t,i,s){super(e,t,i),this.cameraData=s,this.start=new B.Vector3,this.end=new B.Vector3,this.width=.1,this.getLinePositions=(()=>{const e=new B.Vector3,t=new B.Vector3,i=new B.Vector3,s=new B.Vector3,a=new B.Vector3;return()=>{e.copy(this.start),t.copy(this.end);const o=(0,dt.Ko)(e,t,this.cameraData),n=(0,dt.hJ)(this.label.text.length),r=o.pixelDistance>n.width&&this.labelVisible;this.setVisible(r);const d=this.cameraData.isOrtho(),l=d?Math.abs(this.label.position.y-this.cameraData.pose.position.y):this.cameraData.pose.position.distanceTo(this.label.position);i.addVectors(e,t).multiplyScalar(.5),d?(a.subVectors(t,e),a.applyAxisAngle(L.fU.UP,.5*Math.PI).normalize()):a.copy(L.fU.UP);const c=(0,qe._U)(l,this.cameraData.pose.projection.asThreeMatrix4(),this.cameraData.width),h=d?4:10;return s.copy(i),s.addScaledVector(a,.5*this.width+.75*this.label.scale.x+c*h),{start:e,end:t,center:i,labelPosition:s,lineRotation:o.rotation}}})()}updateDimensions(e,t,i,s){this.start.copy(e),this.end.copy(t),this.width=i;const a=this.start.distanceTo(this.end);this.length=a;const o=(0,dt.up)(a,s);this.label.text=o}update(){super.update(),this.updateBillboard()}updateBillboard(){const{labelPosition:e,lineRotation:t}=this.getLinePositions(),{label:i}=this;i.setPosition(e),i.setOrientation(this.cameraData.pose.rotation,t);const{position:s,projection:a}=this.cameraData.pose,o=this.cameraData.aspect(),{height:n}=this.cameraData,r=this.cameraData.zoom(),d=(0,qe.mY)(a,s,i.position,n,Bt.Hn.SCALE),l=(0,qe.Pp)(a)?0:((0,kt.uZ)(o,1,2.5)+r)*Bt.Hn.SCALE_ASPECT,c=1+Bt.Hn.SCALE_NDC-l,h=Math.max(Math.min(1/d*c,3),.001);i.scaleFactor=h}}class zt extends B.Mesh{raycast(e,t){}}class jt extends B.Mesh{}var Gt=i(62944);class $t{constructor(e,t,i,s,a,o,n,r,d,l){this.scene=e,this.input=t,this.inputManager=i,this.editor=s,this.data=a,this.floorsViewData=o,this.cameraData=n,this.locale=r,this.settingsData=l,this.readonly=!1,this.currentFloorId="",this.cameraDirty=!1,this.rootObjects={},this.viewMap=new Map,this.nodeMap=new Map,this.roomMap=new Map,this.openingMap=new Map,this.visibleWallLabels=new Set,this.hideCurrentFloorViews=()=>{if(this.currentFloorId){const e=this.rootObjects[this.currentFloorId];for(const t of e.children)t instanceof Se&&this.unregisterViewToInput(t);this.scene.remove(e)}},this.showCurrentFloorViews=()=>{var e;const t=(null===(e=this.floorsViewData.singleFloor)||void 0===e?void 0:e.id)||this.floorsViewData.currentFloorId;if(t){const e=this.rootObjects[t];this.scene.add(e);for(const t of e.children)t instanceof Se&&this.registerViewToInput(t);this.currentFloorId=t}},this.updateOpeningView=(()=>{const e=new B.Vector3,t=new B.Vector3,i=new B.Vector3,s=new B.Vector3,a=new B.Vector3,o=new B.Vector3;return n=>{var r;const d=this.data.getWall(n.wallId),l=(null===(r=this.floorsViewData.floors.getFloor(d.floorId))||void 0===r?void 0:r.bottom)||0;o.set(0,l,0),d.getBiasAdjustmentVec(a),d.from.getVec3(i).add(a).add(o),d.to.getVec3(s).add(a).add(o),t.subVectors(s,i).normalize(),e.copy(i),e.lerp(s,n.relativePos),i.copy(e).addScaledVector(t,-.5*n.width),s.copy(e).addScaledVector(t,.5*n.width);const c=this.openingMap.get(n.id);if(!c)throw new Error("Unable to find view for opening while updating");c.onEdgePositionChanged(i,s,d.width,n.type)}})(),this.onMove=({target:e})=>{e&&this.toggleLabelChildrenForView(e,!0)},this.hideAllWallLabels=()=>{if(this.visibleWallLabels.size>0){for(const e of this.visibleWallLabels)e.setLabelVisible(!1);this.visibleWallLabels.clear()}},this.onMoveEnd=({target:e})=>{e&&this.toggleLabelChildrenForView(e,!1);for(const e of this.data.rooms.values())this.updateRoomView(e,!0)},this.onSelect=({target:e,previous:t})=>{t&&this.toggleViewWallLabel(t,!1),this.hideAllWallLabels(),e&&this.toggleViewWallLabel(e,!0)},this.onHover=({target:e,previous:t})=>{t&&this.toggleViewWallLabel(t,!1),e&&this.toggleViewWallLabel(e,!0)},this.floorsViewData.floors.iterate((e=>{this.rootObjects[e.id]=new B.Object3D})),this.bindings=[this.data.onWallsChanged({onRemoved:e=>this.removeViewForWall(e),onUpdated:e=>this.updateWallView(e),onAdded:e=>this.makeWallView(e)}),this.data.onNodesChanged({onRemoved:e=>this.removeViewForNode(e),onUpdated:e=>this.updateNodeView(e),onAdded:e=>this.makeNodeView(e)}),this.data.onRoomsChanged({onRemoved:e=>this.removeViewForRoom(e),onUpdated:e=>this.updateRoomView(e,!1),onAdded:e=>this.makeRoomView(e)}),this.data.onOpeningsChanged({onRemoved:e=>this.removeViewForOpening(e),onUpdated:e=>this.updateOpeningView(e),onAdded:e=>this.makeOpeningView(e)}),this.editor.subscribe(R.Events.Move,this.onMove),this.editor.subscribe(R.Events.EditConfirm,this.onMoveEnd),this.editor.subscribe(R.Events.SelectChange,this.onSelect),this.editor.subscribe(R.Events.HoverChange,this.onHover),d.subscribe(Mt.S,this.hideCurrentFloorViews),d.subscribe(xt.P,this.showCurrentFloorViews),n.onChanged((()=>this.cameraDirty=!0)),this.settingsData.onPropertyChanged(At.F.UnitType,(e=>{for(const e of this.data.rooms.values())this.updateRoomView(e,!0);for(const e of this.data.walls.values())this.updateWallView(e)})),this.input.registerMeshHandler(de.z,ge.s.isInstanceOf(jt),((e,t)=>this.roomLabelHover(t,!0))),this.input.registerMeshHandler(de.A,ge.s.isInstanceOf(jt),((e,t)=>this.roomLabelHover(t,!1)))],this.bindings.forEach((e=>e.cancel())),this.labelManager=new Ht(l.tryGetProperty("assetBasePath",""),r.languageCode,n,(()=>o.currentFloorId))}init(){}render(e){this.labelManager.tickAnimations(e);const t=this.cameraData.pose.pitchFactor();for(const i of[this.viewMap,this.nodeMap,this.roomMap,this.openingMap])for(const s of i.values())s.setPitchFactor(t),s.tickAnimations(e)}dispose(){}beforeRender(){this.labelManager.update(),this.cameraDirty&&(this.cameraDirty=!1,this.updateLabels())}activate(e){if(!this.readonly)for(const[e,t]of this.data.nodes)this.makeNodeView(t);for(const[e,t]of this.data.walls)this.makeWallView(t);for(const[e,t]of this.data.rooms)this.makeRoomView(t);for(const[e,t]of this.data.wallOpenings)this.makeOpeningView(t);this.bindings.forEach((e=>e.renew())),this.showCurrentFloorViews()}deactivate(){this.bindings.forEach((e=>e.cancel()));for(const e in this.rootObjects){const t=this.rootObjects[e];this.scene.remove(t);for(const e of t.children.slice())e instanceof Se&&(e.dispose(),this.unregisterViewToInput(e)),t.remove(e)}}updateLabels(){for(const e of this.roomMap.values())e.updateLabelBillboard()}registerViewToInput(...e){var t;for(const i of e)(null===(t=i.parent)||void 0===t?void 0:t.parent)&&(this.input.registerMesh(i,!1),this.inputManager.addEditableEntity(i,i.roomBoundsId))}unregisterViewToInput(...e){for(const t of e)this.input.unregisterMesh(t),this.inputManager.removeEditableEntity(t.roomBoundsId)}makeNodeView(e){var t;const i=new Vt(e.id,this.cameraData),s=(null===(t=this.floorsViewData.floors.getFloor(e.floorId))||void 0===t?void 0:t.bottom)||0;i.updatePosition(new B.Vector3(e.x,s,e.z)),this.nodeMap.set(e.id,i),this.rootObjects[e.floorId].add(i),this.registerViewToInput(i)}updateNodeView(e){var t;const i=this.nodeMap.get(e.id);if(i){const s=(null===(t=this.floorsViewData.floors.getFloor(e.floorId))||void 0===t?void 0:t.bottom)||0;i.updatePosition(new B.Vector3(e.x,s,e.z))}}removeViewForNode(e){const t=this.nodeMap.get(e.id);t&&(this.rootObjects[e.floorId].remove(t),this.nodeMap.delete(e.id),t.dispose(),this.unregisterViewToInput(t))}makeWallView(e){const t=this.labelManager.createWallLabel(e.floorId);t.updateDimensions(e.from.getVec3(),e.to.getVec3(),e.width,this.getUnits());const i=new Dt(e.id,this.cameraData,t);this.viewMap.set(e.id,i),this.rootObjects[e.floorId].add(i,i.stencilMesh),t.addTo(this.rootObjects[e.floorId]),this.updateWallView(e),t.update(),this.registerViewToInput(i)}updateWallView(e){const t=this.viewMap.get(e.id);t&&t.onEdgePositionChanged(this.data,this.floorsViewData,this.getUnits())}removeViewForWall(e){const t=this.viewMap.get(e.id);t&&(this.rootObjects[e.floorId].remove(t,t.stencilMesh),this.labelManager.deleteLabel(t.lineLabel),this.viewMap.delete(e.id),this.visibleWallLabels.delete(t),t.dispose(),this.unregisterViewToInput(t))}makeRoomView(e){var t;const i=this.rootObjects[e.floorId];this.roomMap.has(e.id)&&this.removeViewForRoom(e);const s=(null===(t=this.floorsViewData.floors.getFloor(e.floorId))||void 0===t?void 0:t.bottom)||0,a=new ft(e,s,this.cameraData,this.labelManager,this.getUnits());i.add(a),this.roomMap.set(e.id,a),this.registerViewToInput(a),this.updateRoomView(e,!0)}updateRoomView(e,t){var i;const s=this.roomMap.get(e.id);if(!s)throw new Error("Unable to find view for room while updating.");const a=(null===(i=this.floorsViewData.floors.getFloor(e.floorId))||void 0===i?void 0:i.bottom)||0;s.updateGeo(e,a,this.getUnits()),s.updateLabelBillboard();const o=this.getUnits(),n=e.getArea(o),r=(0,Gt.dO)(o,n).area;s.updateText((0,Tt.LN)(e.id,this.locale,this.data),r,e.getMeasurementText(o),t)}removeViewForRoom(e){const t=this.roomMap.get(e.id);if(!t)throw new Error("Unable to find view for room while deleting.");this.rootObjects[e.floorId].remove(t),this.roomMap.delete(e.id),t.dispose(),this.input.unregisterMesh(t),this.inputManager.removeEditableEntity(e.id)}makeOpeningView(e){const t=this.data.getWall(e.wallId),i=new et(e.id,t.floorId,this.cameraData);this.rootObjects[t.floorId].add(i,i.stencilPrepass,i.startHandle,i.endHandle),this.openingMap.set(e.id,i),this.registerViewToInput(i,i.startHandle,i.endHandle),this.updateOpeningView(e)}removeViewForOpening(e){const t=this.openingMap.get(e.id);if(!t)throw new Error("Unable to find view for opening while deleting.");this.rootObjects[t.floorId].remove(t,t.stencilPrepass,t.startHandle,t.endHandle),this.openingMap.delete(e.id),t.dispose(),this.unregisterViewToInput(t,t.startHandle,t.endHandle)}toggleLabelChildrenForView(e,t){if(this.viewMap.has(e)){const i=this.data.getWall(e);this.toggleViewWallLabel(i.to.id,t),this.toggleViewWallLabel(i.from.id,t)}else this.toggleViewWallLabel(e,t)}toggleViewWallLabel(e,t){const i=this.viewMap.get(e)||this.roomMap.get(e);if(i){const e=i.hoverState.active,s=i.selectState.active||i.highlightState.active,a=e||s||t;i.setLabelVisible(a),i instanceof Dt&&(a?this.visibleWallLabels.add(i):this.visibleWallLabels.delete(i))}if(this.nodeMap.has(e)){const i=this.data.getNode(e);if(i){const e=this.data.getWallsForNode(i);for(const i of e)this.toggleViewWallLabel(i.id,t)}}}roomLabelHover(e,t){const i=e.userData.roomId,s=this.roomMap.get(i);s&&s instanceof ft&&s.hoverRoomLabel(t)}getUnits(){return this.settingsData.tryGetProperty(At.F.UnitType,Rt.M.IMPERIAL)}}var qt=i(18544),Yt=i(85893),Zt=i(67294),Kt=i(33558),Xt=i(38399),Jt=i(1358);function Qt(e,t,i){const[s,a]=(0,Zt.useState)(null===e?i:e[t]);return(0,Zt.useEffect)((()=>{if(null===e)return;const i=e.onPropertyChanged(t,(e=>{a(e)}));return()=>i.cancel()}),[e,t,i]),s}const ei=(0,i(45755).u)(qt.e);function ti(){const e=ei();return(null==e?void 0:e.editorState)||null}function ii(){const e=(0,Jt.S)(),t=Qt(ti(),"selected",null);return t&&e?e.getEntity(t):null}var si=i(38490),ai=i(84426),oi=i(79820),ni=i(66102),ri=i(94184),di=i.n(ri),li=i(56064),ci=i(78283);function hi({children:e,containerClass:t,titleKey:i,measurementsInMetric:s,measurementType:a,isHideable:o,visible:n,onToggle:r}){const d=(0,li.O)(),l=(0,ni.b)();let c=[];if(a===Gt.RV.AREA){const e=d===Rt.M.IMPERIAL?Gt.QK:Gt.G8;c=s.filter((e=>!isNaN(e))).map(((t,i)=>{const s=d===Rt.M.IMPERIAL?Math.round((0,ci.Nv)(t)):Math.round(10*t)/10;return(0,Yt.jsx)(pi,{measure:s,unit:e},i)}))}else a===Gt.RV.DISTANCE&&(c=s.filter((e=>!isNaN(e))).map(((e,t)=>{const i=[];if(t>0&&i.push((0,Yt.jsx)(gi,{},`${t}_sep`)),d===Rt.M.IMPERIAL){const{feet:s,inches:a}=(0,ci.XJ)(e);s>0?i.push((0,Yt.jsx)(pi,{measure:s,unit:Gt.B5},t),(0,Yt.jsx)(pi,{measure:a,unit:Gt.FP},`${t}_minor`)):i.push((0,Yt.jsx)(pi,{measure:a,unit:Gt.FP},t))}else i.push((0,Yt.jsx)(pi,{measure:e.toFixed(2),unit:Gt.Ep},t));return i})).flat());const h=n?"eye-show":"eye-hide",u=l.t(i);return(0,Yt.jsxs)("div",Object.assign({className:di()("room-detail",t)},{children:[(0,Yt.jsx)("div",Object.assign({className:"p5"},{children:u})),(0,Yt.jsxs)("div",Object.assign({className:"room-detail-info"},{children:[(0,Yt.jsx)(ui,{measures:c,dimmed:!n}),o&&(0,Yt.jsx)(ai.zx,{icon:h,active:!0,onClick:r})]})),e]}))}function ui({measures:e,dimmed:t}){return 0===e.length?(0,Yt.jsx)(mi,{}):(0,Yt.jsx)("div",Object.assign({className:("multi-pretty-measure-container "+(t?"dimmed":"")).trim()},{children:e}))}function mi(){return(0,Yt.jsx)("div",Object.assign({className:"pretty-measure-container"},{children:(0,Yt.jsx)("div",Object.assign({className:"p5"},{children:"n/a"}))}))}function pi({measure:e,unit:t}){return(0,Yt.jsxs)("div",Object.assign({className:"pretty-measure-container"},{children:[(0,Yt.jsx)("div",Object.assign({className:"h5 measure"},{children:e})),(0,Yt.jsx)("div",Object.assign({className:"p5 unit"},{children:t}))]}))}function gi(){return(0,Yt.jsx)("div",Object.assign({className:"p5 separator"},{children:Gt.RQ}))}function vi({room:e}){const t=(0,ni.b)().t(Xt.Z.SHOWCASE.ROOMS.ROOM_INFORMATION);return(0,Yt.jsxs)("div",Object.assign({className:"room-size-info"},{children:[(0,Yt.jsx)("div",Object.assign({className:"room-info-title"},{children:t})),(0,Yt.jsxs)("div",Object.assign({className:"room-info-detail-container"},{children:[(0,Yt.jsx)(hi,{titleKey:Xt.Z.SHOWCASE.ROOMS.ROOM_AREA,measurementsInMetric:[e.area],measurementType:Gt.RV.AREA,isHideable:!1,visible:!0}),(0,Yt.jsx)(hi,{titleKey:Xt.Z.SHOWCASE.ROOMS.ROOM_DIMENSIONS,measurementsInMetric:[e.length,e.width],measurementType:Gt.RV.DISTANCE,isHideable:!1,visible:!0}),(0,Yt.jsx)(hi,{titleKey:Xt.Z.SHOWCASE.ROOMS.ROOM_HEIGHT,measurementsInMetric:[e.height],measurementType:Gt.RV.DISTANCE,isHideable:!1,visible:!0}),(0,Yt.jsx)(hi,{titleKey:Xt.Z.SHOWCASE.ROOMS.ROOM_PERIMETER,measurementsInMetric:[e.perimeter],measurementType:Gt.RV.DISTANCE,isHideable:!1,visible:!0})]}))]}))}function fi({room:e}){const t=(0,Jt.S)(),i=(0,ni.b)(),s=(0,Tt.LN)(e.id,i,t);return(0,Yt.jsx)("div",Object.assign({className:"room-title"},{children:s}))}var wi=i(65428);function yi(){const{locale:e,commandBinder:t}=(0,Zt.useContext)(Kt.I),i=(0,wi.A)(),s=function(){const e=ii();return e&&e instanceof X.JJ?e:null}(),a=i&&(i===d.w1.SEARCH||i===d.w1.LAYERS);async function o(){a?(await t.issueCommand(new h.cR),await t.issueCommand(new h.qy(!1))):s&&t.issueCommand(new P.pZ(s.id))}const n=e.t(a?Xt.Z.SHOWCASE.ROOMS.BACK:Xt.Z.SHOWCASE.ROOMS.CLOSE),r=a?"back":"close";return(0,Yt.jsxs)(oi.J,Object.assign({open:!!s,onClose:o},{children:[(0,Yt.jsx)("div",Object.assign({className:"detail-panel-header"},{children:(0,Yt.jsx)(si.P,{label:n,className:"return-btn",icon:r,size:ai.qE.SMALL,onClose:o})})),(0,Yt.jsxs)("div",Object.assign({className:"room-view"},{children:[s&&(0,Yt.jsx)(fi,{room:s}),s&&(0,Yt.jsx)(vi,{room:s})]}))]}))}class Si{constructor(){}renderPanel(){return(0,Yt.jsx)(yi,{})}}var bi=i(40964);class Ei{constructor(e,t,i){this.engine=e,this.toolsData=t,this.viewData=i,this.bindings=[],this.selectionChanged=async e=>{if(this.toolsData.activeToolName===d.w1.ROOM_BOUNDS)return;const t=this.viewData.getSelectedRoom(e);this.toolsData.activeToolName===d.w1.ROOM_VIEW!==!!t&&(await this.engine.commandBinder.issueCommand(new h.tT(d.w1.ROOM_VIEW,!!t)),this.engine.broadcast(t?new bi.ro:new bi.A))},this.bindings.push(this.viewData.editorState.onPropertyChanged("selected",this.selectionChanged))}async activate(){}async deactivate(){}async dispose(){this.bindings.forEach((e=>e.cancel()))}}var Di=i(38042),Ii=i(79727),Ci=i(33324),Oi=i(9037);const Ai=.5;class xi{constructor(e){this.axis=new Mi(e),this.orthoAxis=new Mi(e)}showAt(e,t){this.axis.setPosition(e),this.axis.show(),t?(this.orthoAxis.setPosition(t),this.orthoAxis.show()):this.orthoAxis.hide()}hide(){this.axis.hide(),this.orthoAxis.hide()}dispose(){this.axis.dispose(),this.orthoAxis.dispose()}}class Mi{constructor(e){this.scene=e,this.setPosition=(()=>{const e=new B.Vector3,t=new B.Vector3,i=new B.Vector3,s=new B.Vector3;return a=>{i.subVectors(a.end,a.start).normalize(),s.copy(i).applyAxisAngle(L.fU.UP,Math.PI/2),e.copy(a.start).addScaledVector(i,-1e3),t.copy(a.start).addScaledVector(i,1e3),this.alignedAxis.updateEndpoints(e,t),e.copy(a.start).addScaledVector(s,Ai),t.copy(a.start).addScaledVector(i,Ai).addScaledVector(s,Ai),this.angleIndictorLine1.updateEndpoints(e,t),e.copy(a.start).addScaledVector(s,-1e3),t.copy(a.start).addScaledVector(s,1e3),this.orthoAxis.updateEndpoints(e,t),e.copy(a.start).addScaledVector(i,Ai),t.copy(a.start).addScaledVector(s,Ai).addScaledVector(i,Ai),this.angleIndictorLine2.updateEndpoints(e,t)}})();const t={dashed:!1,dashSize:1,gapSize:1,lineWidth:1,color:ve.I.MP_BRAND,dashUnits:wt.PIXELS,depthWrite:!1,depthTest:!1,depthFunc:B.AlwaysDepth,opacity:1},i={dashed:!0,dashSize:5,gapSize:2,lineWidth:1,color:ve.I.MP_BRAND,dashUnits:wt.PIXELS,depthWrite:!1,depthTest:!1,depthFunc:B.AlwaysDepth,opacity:1};this.alignedAxis=new bt(new B.Vector3,new B.Vector3,i),this.orthoAxis=new bt(new B.Vector3,new B.Vector3,i),this.angleIndictorLine1=new bt(new B.Vector3,new B.Vector3,t),this.angleIndictorLine2=new bt(new B.Vector3,new B.Vector3,t),this.scene.add(this.alignedAxis),this.scene.add(this.orthoAxis),this.scene.add(this.angleIndictorLine1),this.scene.add(this.angleIndictorLine2),this.hide()}show(){this.alignedAxis.visible=!0,this.orthoAxis.visible=!0,this.angleIndictorLine1.visible=!0,this.angleIndictorLine2.visible=!0}hide(){this.alignedAxis.visible=!1,this.orthoAxis.visible=!1,this.angleIndictorLine1.visible=!1,this.angleIndictorLine2.visible=!1}dispose(){this.scene.remove(this.alignedAxis),this.scene.remove(this.orthoAxis),this.scene.remove(this.angleIndictorLine1),this.scene.remove(this.angleIndictorLine2)}}var Ri=i(95512),Ti=i(20217),Vi=i(61282),Ni=i(61864);var Pi=i(42147),Li=i(23254),Fi=i(54244),ki=i(10374),Bi=i(64918),Wi=i(55450),Hi=i(18596),_i=i(23037);class Ui extends x.v0{constructor(e){super(),this.target=e}}class zi extends Ui{}class ji extends Ui{}class Gi extends Ui{}class $i extends Ui{}class qi extends Ui{}var Yi,Zi=i(7402),Ki=i(76957);!function(e){e[e.INACTIVE=0]="INACTIVE",e[e.ACTIVE_EDIT=1]="ACTIVE_EDIT",e[e.ACTIVE_READ_ONLY=2]="ACTIVE_READ_ONLY"}(Yi||(Yi={}));const Xi=[d.w1.ROOM_BOUNDS,d.w1.SEARCH,d.w1.LAYERS,d.w1.ROOM_VIEW];class Ji extends a.Y{constructor(){super(...arguments),this.name="room_bound",this.state=Yi.INACTIVE,this.disabledAssets={[w.U]:!1,[f.s]:!1,[m.re]:!1,[v.Mp]:!1,[_i.Nj]:!1},this.disabledAssetsReadOnly={[_i.Nj]:!1},this.activate=async()=>{const e=Yi.ACTIVE_EDIT;await this.tryDeactivate(e),this.state=e,this.disableUnrelatedAssets.toggle(!0),this.floorsViewData.onlyShowActiveFloor.value=!0,await(0,r.E)(this.cameraData,this.viewmodeData),await this.commandBinder.issueCommand(new S._i(S.BD.DOLLHOUSE,Bi.n.FadeToBlack,this.getStartCameraPose(),Wi.DEFAULT_TRANSITION_TIME/2)),await this.commandBinder.issueCommand(new Ti.Cy({phiUpperLimitDegrees:90,phiLowerLimitDegrees:Vi.bp*ct.MN,noTransition:!0})),await this.commandBinder.issueCommand(new Pi.Nb),await this.commandBinder.issueCommand(new Ti.EG),await this.commandBinder.issueCommand(new Ri.y(!0)),await(0,r.E)(this.cameraData,this.viewmodeData),await this.commandBinder.issueCommand(new b.M),await this.commandBinder.issueCommand(new Ci.tR),await this.commandBinder.issueCommand(new Ci.TS),await this.commandBinder.issueCommand(new Ti.ho),this.updateCursor(),this.editor.start(),this.renderer.readonly=!1,this.engine.addComponent(this,this.renderer),this.viewData.setRoomBoundVisible(!0),this.inputManager.activate(!1)},this.activateReadOnly=async()=>{const e=Yi.ACTIVE_READ_ONLY;this.state!==e&&(await this.tryDeactivate(e),this.state=e,this.disableUnrelatedAssetsReadOnly.toggle(!0),this.editor.startReadOnly(),this.renderer.readonly=!0,this.engine.addComponent(this,this.renderer),this.viewData.setRoomBoundVisible(!0),this.inputManager.activate(!0),await(0,r.E)(this.cameraData,this.viewmodeData),this.updateCursor())},this.deactivateReadOnly=async(e=Yi.INACTIVE)=>{if(this.state===Yi.ACTIVE_READ_ONLY){[Yi.ACTIVE_EDIT,Yi.INACTIVE].includes(e)&&this.editor.exit(),this.engine.removeComponent(this,this.renderer),this.viewData.setRoomBoundVisible(!1),this.inputManager.deactivate(),this.disableUnrelatedAssetsReadOnly.toggle(!1),this.state=e}},this.deactivate=async(e=Yi.INACTIVE)=>{e===Yi.INACTIVE&&this.editor.exit(),this.engine.removeComponent(this,this.renderer),this.viewData.setRoomBoundVisible(!1),this.inputManager.deactivate(),this.disableUnrelatedAssets.toggle(!1),this.snappingAxesRenderer.hide();const t=this.cameraData.isOrtho(),i=this.cameraData.orthoZoom(),s=this.cameraData.pose.fovCorrectedPosition(),a=this.cameraData.pose.rotation.clone();await this.commandBinder.issueCommand(new b.I),await this.commandBinder.issueCommand(new Ti.Cy({noTransition:!0})),t||await this.commandBinder.issueCommand(new Pi.qK),await this.commandBinder.issueCommand(new Ti.HF),await this.commandBinder.issueCommand(new Ci.LW),await this.commandBinder.issueCommand(new Ri.y(!1)),await this.commandBinder.issueCommand(new Ci.Md),await this.commandBinder.issueCommand(new p.u(g.C.DEFAULT)),this.floorsViewData.onlyShowActiveFloor.value=!1,this.state=Yi.INACTIVE,t&&await this.commandBinder.issueCommand(new S._i(S.BD.FLOORPLAN,Bi.n.Instant,{position:s,rotation:a,zoom:i}))},this.tryDeactivate=async e=>{this.state===Yi.ACTIVE_EDIT?await this.deactivate(e):this.state===Yi.ACTIVE_READ_ONLY&&await this.deactivateReadOnly(e)},this.unselect=async e=>{e&&(await this.updateShowcaseVisibility(),this.state!==Yi.INACTIVE&&this.editor.deselect())},this.undo=async()=>{await this.ensureValidViewMode(),this.editor.discard(),this.data.undo(),this.engine.broadcast(new zi)},this.edit=async e=>{const t=this.editor.state;t.toolState===R.ToolState.EDITING&&t.currentId&&this.editor.tryCommit(),this.editor.edit(e)},this.finishEdit=()=>{this.editor.tryCommit()},this.cancelEdit=async()=>{await this.ensureValidViewMode(),this.editor.discard()},this.exitEdit=()=>{this.editor.discard()},this.deleteEntity=async e=>{await this.ensureValidViewMode();const t=this.editor.state,i=e.id||t.currentId;i&&(this.engine.broadcast(new Gi(i)),this.editor.discard(),this.data.deleteEntity(i),this.data.finalizeHistory())},this.addEntity=async({addState:e,wallType:t})=>{await this.ensureValidViewMode();const i=this.editor.state.toolState;i!==R.ToolState.IDLE&&i!==R.ToolState.SELECTED&&this.editor.discard(),this.editor.state.addType=e,void 0!==t&&(this.editor.state.wallType=t),this.editor.waitForAdd()},this.updateCursor=()=>{this.commandBinder.issueCommand(new p.u(this.editor.state.cursor))},this.raycastModel=(()=>{const e=new B.Raycaster;let t=-1,i="";return(s,a)=>{const o=this.modelMesh.setChunkSide(B.DoubleSide);e.set(s,L.fU.DOWN);const n=this.raycaster.getOctree(),r=a===i?t:this.floorsData.getFloor(a).meshGroup;i=a,t=r;const d=n.raycast(e).filter((e=>{return(t=e.object)instanceof Zi.g&&t.meshGroup===r;var t}));return this.modelMesh.setChunkSide(o),d}})()}async init(e,t){this.commandBinder=t.commandBinder,this.engine=t;const[i,a,r,d,c,h,m,p,g,v,f,w,S]=await Promise.all([t.getModuleBySymbol(s.PZ),t.getModuleBySymbol(s.fQ),t.market.waitForData(V.Z),t.getModuleBySymbol(s.Aj),t.market.waitForData(o.e),t.market.waitForData(Ii.c),t.market.waitForData(Oi.M),t.getModuleBySymbol(s.e9),t.market.waitForData(Li.O),t.market.waitForData(Fi.pu),t.market.waitForData(l.t),t.market.waitForData(Ki.i),t.getModuleBySymbol(s.Ve)]);this.data=r,this.data.raycast=this.raycastModel,this.data.onActionError=e=>{this.applicationData.error=e,this.applicationData.commit()},this.floorsViewData=h,this.cameraData=m,this.viewmodeData=g,this.applicationData=v,this.toolsData=f,this.settingsData=c,this.raycaster=a,this.floorsData=w,this.modelMesh=S,this.disableUnrelatedAssets=new n.u(c,this.disabledAssets),this.disableUnrelatedAssetsReadOnly=new n.u(c,this.disabledAssetsReadOnly),this.snappingAxesRenderer=new xi(d.getScene());const b=new B.Vector3,E=()=>{var e;const t=i.getCurrentPointerRay();return b.set(0,0,0),h.currentFloor&&t.intersectPlane(null===(e=h.currentFloor)||void 0===e?void 0:e.groundPlane,b),b};this.editor=new Ot(E,i,a,t.msgBus,r,this.floorsViewData,m.pose,t.commandBinder,e.rootNode);const D=c.tryGetProperty(u.gx.RoomBounds,!1);this.viewData=new qt.e(this.data,this.editor.state,D),this.addToolPanel(),this.inputManager=new ee(this.editor,E,r,m,this.snappingAxesRenderer,i.keyboardState),this.renderer=new $t(d.getScene(),i,this.inputManager,this.editor,this.data,this.floorsViewData,m,p,t,c),this.bindings.push(this.editor.subscribe(R.Events.CurrentChange,(({target:e})=>{this.engine.broadcast(new qi(e))})),this.editor.subscribe(R.Events.EditConfirm,(({target:e})=>{this.engine.broadcast(new $i(e))})),this.editor.subscribe(R.Events.AddConfirm,(({target:e})=>{this.engine.broadcast(new ji(e))})),t.commandBinder.addBinding(P.Yx,this.activate),t.commandBinder.addBinding(P.Rc,(async()=>this.deactivate())),t.commandBinder.addBinding(P.pZ,(async e=>this.unselect(e.id))),t.commandBinder.addBinding(P.Os,(async e=>this.toggleVisibilityForViewer(e.visible))),this.editor.state.onPropertyChanged("cursor",this.updateCursor),g.currentModeObservable.onChanged((()=>this.updateShowcaseVisibility())),this.toolsData.onPropertyChanged("activeToolName",(()=>this.updateShowcaseVisibility())),t.subscribe(ki.pB,(e=>{this.updateShowcaseVisibility(),e.application===Fi.Mx.SHOWCASE&&this.addToolPanel()}))),e.readonly||this.bindings.push(t.commandBinder.addBinding(P.pd,(async e=>this.deleteEntity(e))),t.commandBinder.addBinding(P.o3,(async()=>this.undo())),t.commandBinder.addBinding(P.vQ,this.addEntity),t.commandBinder.addBinding(P.mB,(async e=>this.edit(e.id))),t.commandBinder.addBinding(P.DE,(async()=>this.finishEdit())),t.commandBinder.addBinding(P._j,this.cancelEdit),t.commandBinder.addBinding(P.bw,(async()=>this.exitEdit())),t.commandBinder.addBinding(P.Km,(async e=>this.editRoomData("name",e.id,e.data))),t.commandBinder.addBinding(P.c8,(async e=>this.editRoomTypes(e.id,e.data))),t.commandBinder.addBinding(P.jL,(async e=>this.editRoomOutside(e.id,e.data))),t.commandBinder.addBinding(P.hu,(async e=>this.editRoomData("includeInAreaCalc",e.id,e.data))),t.commandBinder.addBinding(P.bS,(async e=>this.editRoomData("hide",e.id,e.data))),t.commandBinder.addBinding(P.mU,(async e=>this.editRoomData("showDimensions",e.id,e.data))),t.commandBinder.addBinding(P.Ii,(async e=>this.editRoomData("showHeight",e.id,e.data))),c.onPropertyChanged(u.gx.RoomBounds,(()=>this.updateShowcaseAvailability())),c.onPropertyChanged(y.dF,(()=>this.updateShowcaseAvailability()))),t.market.register(this,qt.e,this.viewData),this.updateShowcaseAvailability(),async function(e){const t=await e.market.waitForData(o.e),i=await e.getModuleBySymbol(Ni.Ak),s=(e,s,a)=>{i.registerSetting("Room Bounds"+e,e+s+"Inner",a.innerColor,!0),t.onPropertyChanged(e+s+"Inner",(e=>a.innerColor=e)),i.registerSetting("Room Bounds"+e,e+s+"Outer",a.outerColor,!0),t.onPropertyChanged(e+s+"Outer",(e=>a.outerColor=e)),i.registerSetting("Room Bounds"+e,e+s+"Opacity",a.opacity,!0),t.onPropertyChanged(e+s+"Opacity",(e=>a.opacity=e))},a=(e,t)=>{s(e,"Base",t.baseState),s(e,"Hover",t.hoverState),s(e,"Select",t.selectState),s(e,"Dim",t.dimState)};a("Node",Ye),a("Edge",Et),a("Room",vt),i.registerButton("Room Bounds Export","Export colors",(()=>{const e={Node:Ye,Edge:Et,Room:vt},t=JSON.stringify(e);navigator.clipboard.writeText(t)})),i.registerButton("Room Bounds Export","Import colors",(async()=>{const e=(e,t,i)=>{s(e.baseState,t.baseState,i,"Base"),s(e.hoverState,t.hoverState,i,"Hover"),s(e.selectState,t.selectState,i,"Select"),s(e.dimState,t.dimState,i,"Dim")},s=(e,t,s,a)=>{e.innerColor=new B.Color(t.innerColor),e.outerColor=new B.Color(t.outerColor),e.opacity=t.opacity;const o=s+a;i.updateSetting(o+"Inner",e.innerColor),i.updateSetting(o+"Outer",e.outerColor),i.updateSetting(o+"Opacity",e.opacity)},a=await navigator.clipboard.readText(),o=JSON.parse(a);o&&(e(Ye,o.Node,"Node"),e(Et,o.Edge,"Edge"),e(vt,o.Room,"Room")),t.setDirty(!0),t.commit()}))}(t)}dispose(e){super.dispose(e),e.market.unregister(this,qt.e)}toggleVisibilityForViewer(e){this.viewData.visibleInShowcase=e,this.viewData.commit(),this.updateShowcaseVisibility()}async updateShowcaseAvailability(){const e=this.settingsData.tryGetProperty(u.gx.RoomBounds,!1),t=this.settingsData.tryGetProperty(y.dF,!1),i=e&&t;this.settingsData.setProperty(N.hW,i),i&&!this.viewData.visibleInShowcase?this.toggleVisibilityForViewer(!0):this.updateShowcaseVisibility()}async updateShowcaseVisibility(){const{application:e}=this.applicationData,t=e===Fi.Mx.SHOWCASE,i=e===Fi.Mx.WORKSHOP,s=this.settingsData.tryGetProperty(N.hW,!1),a=t&&this.viewData.visibleInShowcase&&s||i,o=null==this.toolsData.activeToolName||Xi.includes(this.toolsData.activeToolName),n=this.viewmodeData.isFloorplan(),r=this.data.rooms.size>0;a&&n&&o&&r?await this.activateReadOnly():await this.deactivateReadOnly()}async addToolPanel(){if(!this.toolsData.getTool(d.w1.ROOM_VIEW)){const e=new Ei(this.engine,this.toolsData,this.viewData),t=new c.U({id:d.w1.ROOM_VIEW,panel:!0,enabled:!0,dimmed:!1,manager:e,ui:new Si,analytic:"rooms_view"});await this.engine.commandBinder.issueCommand(new h.MV([t]))}}editRoomData(e,t,i){this.data.getRoom(t)[e]!==i&&(this.data.setRoomDetails(t,{[e]:i}),this.data.finalizeHistory())}editRoomOutside(e,t){const i=t?X.Lh.OUTDOOR:X.Lh.INDOOR;this.data.getRoom(e).location!==i&&(this.data.setRoomDetails(e,{location:i}),this.data.finalizeHistory())}editRoomTypes(e,t){const i=this.data.getRoom(e).classifications.map((e=>e.id));if(!(0,Di.E8)(t,i)){const i=t.map((e=>this.data.roomClassifications[e])),{location:s,includeInAreaCalc:a,hide:o,keywords:n}=(0,X.Ci)((0,X.Hc)(i));this.data.setRoomDetails(e,{roomTypeIds:t,location:s,includeInAreaCalc:a,hide:o,keywords:n}),this.data.finalizeHistory()}}getStartCameraPose(){const e=this.floorsViewData.currentFloor||this.floorsViewData.getFloor(this.floorsViewData.bottomFloorId),t=e.bottom,i=e.boundingBox.getCenter(new B.Vector3);i.y=t;const s=e.boundingBox.max.clone();s.y=t;const a=i.distanceTo(s)/Math.tan(Hi.oR.fov/2*ct.Ue),o=L.Hk.DOWNWARD.clone().multiply((new B.Quaternion).setFromAxisAngle(L.fU.RIGHT,45*ct.Ue)),n=L.fU.FORWARD.clone().applyQuaternion(o).multiplyScalar(-1*a);return{position:i.clone().add(n),rotation:o}}async ensureValidViewMode(){this.cameraData.pose.autoOrthoApplied&&await this.engine.commandBinder.issueCommand(new Ti.ho)}}},20241:(e,t,i)=>{"use strict";i.d(t,{d:()=>s});class s{constructor(e){this.tags=[],e&&Object.assign(this,e)}}},94046:(e,t,i)=>{"use strict";i.d(t,{i:()=>a});var s=i(81396);class a extends s.Mesh{}},6282:(e,t,i)=>{"use strict";async function s(e,t){if(await e.transition.promise,!t.canStartTransition()){const e=new Promise((e=>{const i=t.onChanged((()=>{t.canStartTransition()&&(i.cancel(),e())}))}));await e}}i.d(t,{E:()=>s})},44724:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform float opacity;uniform vec3 color;uniform sampler2D bg;varying vec2 vUv;void main(){vec4 bgColor=texture2D(bg,vUv);gl_FragColor=vec4(bgColor.rgb,bgColor.a*opacity);}"},52059:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform vec3 diffuse;uniform float opacity;uniform sampler2D mask;\n#ifdef USE_DASH\nuniform float dashSize;uniform float gapSize;\n#endif\nvarying float vLineDistance;\n#include <common>\nvarying vec2 vUv;void main(){\n#ifdef USE_DASH\nif(vUv.y<-1.||vUv.y>1.)discard;if(mod(vLineDistance,dashSize+gapSize)>dashSize)discard;\n#endif\n#ifdef USE_MASK\nvec2 modUv=vec2(vUv);modUv*=2.;vec4 texelColor=texture2D(mask,modUv);gl_FragColor=vec4(texelColor.rgb,min(texelColor.a,opacity));\n#else\ngl_FragColor=vec4(diffuse,opacity);\n#endif\n}"},7188:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;\n#include <common>\nuniform float linewidth;uniform vec2 resolution;attribute vec3 instanceStart;attribute vec3 instanceEnd;attribute vec3 instanceColorStart;attribute vec3 instanceColorEnd;varying vec2 vUv;\n#ifdef USE_DASH\nuniform float dashScale;attribute float instanceDistanceStart;attribute float instanceDistanceEnd;varying float vLineDistance;\n#endif\nvoid trimSegment(const in vec4 start,inout vec4 end){float a=projectionMatrix[2][2];float b=projectionMatrix[3][2];float nearEstimate=-0.5*b/a;float alpha=(nearEstimate-start.z)/(end.z-start.z);end.xyz=mix(start.xyz,end.xyz,alpha);}void main(){\n#ifdef USE_COLOR\nvColor.xyz=(position.y<0.5)?instanceColorStart:instanceColorEnd;\n#endif\n#ifdef USE_DASH\nvLineDistance=(position.y<0.5)?dashScale*instanceDistanceStart:dashScale*instanceDistanceEnd;\n#endif\nfloat aspect=resolution.x/resolution.y;vUv=uv;vec4 start=modelViewMatrix*vec4(instanceStart,1.);vec4 end=modelViewMatrix*vec4(instanceEnd,1.);bool perspective=(projectionMatrix[2][3]==-1.);if(perspective){if(start.z<0.&&end.z>=0.){trimSegment(start,end);}else if(end.z<0.&&start.z>=0.){trimSegment(end,start);}}vec4 clipStart=projectionMatrix*start;vec4 clipEnd=projectionMatrix*end;vec2 ndcStart=clipStart.xy/clipStart.w;vec2 ndcEnd=clipEnd.xy/clipEnd.w;vec2 dir=ndcEnd-ndcStart;dir.x*=aspect;dir=normalize(dir);vec2 offset=vec2(dir.y,-dir.x);dir.x/=aspect;offset.x/=aspect;if(position.x<0.)offset*=-1.;offset*=linewidth;offset/=resolution.y;vec4 clip=(position.y<0.5)?clipStart:clipEnd;\n#ifdef USE_MASK\noffset*=(clipEnd.w+clipStart.w)*0.5;\n#else\noffset*=clip.w;\n#endif\nclip.xy+=offset;gl_Position=clip;\n#include <worldpos_vertex>\n}"},56449:e=>{e.exports="precision highp float;uniform vec3 color;uniform float antialiasWidth;uniform float lineWidth;uniform float dashed;uniform float dashSize;uniform float gapSize;uniform float opacity;varying float vDistanceFromAxis;varying float vDistanceAlong;void main(){float halfWidth=lineWidth*0.5;float antialiasing=1.-smoothstep(halfWidth,halfWidth+antialiasWidth,vDistanceFromAxis);float dashOpacity=1.;if(dashed>0.){\n#ifdef WORLDSPACE_DASH\nfloat dashAA=fwidth(vDistanceAlong)*antialiasWidth*0.5;\n#else\nfloat dashAA=antialiasWidth*0.5;\n#endif\nfloat dashT=mod(vDistanceAlong,dashSize+gapSize);dashOpacity=smoothstep(0.,dashAA,dashT)*(1.-smoothstep(dashSize-dashAA,dashSize,dashT));}gl_FragColor=vec4(color,opacity*dashOpacity*antialiasing);}"},75215:e=>{e.exports="precision highp float;uniform vec2 screenSize;vec2 rotate90(vec2 v){return vec2(-v.y,v.x);}vec2 ndcToScreen(vec4 pt){return pt.xy*screenSize/2.;}vec2 screenToNdc(vec2 pt){return pt*2./screenSize;}uniform vec3 start;uniform vec3 end;uniform float lineWidth;uniform float antialiasWidth;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;attribute float offsetDirection;attribute float t;varying float vDistanceFromAxis;varying float vDistanceAlong;void main(){vec4 startNdc=projectionMatrix*modelViewMatrix*vec4(start,1.);vec4 endNdc=projectionMatrix*modelViewMatrix*vec4(end,1.);float z=mix(startNdc.z,endNdc.z,t);float w=mix(startNdc.w,endNdc.w,t);vec2 startScreen=ndcToScreen(startNdc/startNdc.w);vec2 endScreen=ndcToScreen(endNdc/endNdc.w);float halfWidth=lineWidth*0.5+antialiasWidth;vec2 directionScreen=endScreen-startScreen;vec2 widthOffsetScreen=rotate90(normalize(directionScreen))*offsetDirection*halfWidth;vec2 position=startScreen+directionScreen*t+widthOffsetScreen;vDistanceFromAxis=length(widthOffsetScreen);\n#ifdef WORLDSPACE_DASH\nvDistanceAlong=length((end-start)*t);\n#else\nvDistanceAlong=length(directionScreen*t);\n#endif\nvec2 posNdc=screenToNdc(position);gl_Position=vec4(posNdc*w,z,w);}"},32988:e=>{e.exports="precision highp float;uniform float paddingPx;uniform float aaPaddingPx;uniform vec3 color;uniform float opacity;varying vec2 vOffsetPx;uniform float outline;uniform vec3 outlineColor;varying vec2 scaledWidthHeightPx;float sdTriangle(vec2 p,vec2 p0,vec2 p1,vec2 p2){vec2 e0=p1-p0;vec2 e1=p2-p1;vec2 e2=p0-p2;vec2 v0=p-p0;vec2 v1=p-p1;vec2 v2=p-p2;vec2 pq0=v0-e0*clamp(dot(v0,e0)/dot(e0,e0),0.,1.);vec2 pq1=v1-e1*clamp(dot(v1,e1)/dot(e1,e1),0.,1.);vec2 pq2=v2-e2*clamp(dot(v2,e2)/dot(e2,e2),0.,1.);float s=e0.x*e2.y-e0.y*e2.x;vec2 d=min(min(vec2(dot(pq0,pq0),s*(v0.x*e0.y-v0.y*e0.x)),vec2(dot(pq1,pq1),s*(v1.x*e1.y-v1.y*e1.x))),vec2(dot(pq2,pq2),s*(v2.x*e2.y-v2.y*e2.x)));return-sqrt(d.x)*sign(d.y);}void main(){float padding=aaPaddingPx+outline;float halfWidth=scaledWidthHeightPx.x/2.;vec2 p0=vec2(-halfWidth,scaledWidthHeightPx.y+padding);vec2 p1=vec2(halfWidth,scaledWidthHeightPx.y+padding);vec2 p2=vec2(0.,padding);float sd=sdTriangle(vOffsetPx,p0,p1,p2);float aaOpacity=1.-smoothstep(outline,outline+0.5,sd);float colorMix=smoothstep(0.,outline,sd);vec3 colorWithOutline=mix(color,outlineColor,colorMix);gl_FragColor=vec4(colorWithOutline,aaOpacity*opacity);}"},1621:e=>{e.exports="precision highp float;uniform vec2 screenSize;vec2 rotate90(vec2 v){return vec2(-v.y,v.x);}vec2 ndcToScreen(vec4 pt){return pt.xy*screenSize/2.;}vec2 screenToNdc(vec2 pt){return pt*2./screenSize;}\n#define MIN_SCALE  0.4\n#define MIN_METERS_PER_PX  0.006\n#define MAX_METERS_PER_PX  0.012\nuniform float paddingPx;uniform float widthPx;uniform float heightPx;uniform float aaPaddingPx;uniform float metersPerPx;uniform float outline;uniform vec2 tip;uniform vec2 normal;uniform float height;attribute vec2 offset;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;varying vec2 vOffsetPx;varying vec2 scaledWidthHeightPx;vec2 scaleByZoom(){float t=clamp((metersPerPx-MIN_METERS_PER_PX)/(MAX_METERS_PER_PX-MIN_METERS_PER_PX),0.,1.);float scale=mix(1.,MIN_SCALE,t);return vec2(widthPx,heightPx)*scale;}void main(){vec2 yAxis=normal;vec2 xAxis=rotate90(yAxis);vec4 tipWorld=vec4(tip.x,height,tip.y,1.);vec4 xOffsetWorld=tipWorld+vec4(xAxis.x,0.,xAxis.y,0.);vec4 yOffsetWorld=tipWorld+vec4(yAxis.x,0.,yAxis.y,0.);vec4 ndcTip=projectionMatrix*modelViewMatrix*tipWorld;vec2 tipScreen=ndcToScreen(ndcTip/ndcTip.w);vec4 ndcXOffset=projectionMatrix*modelViewMatrix*xOffsetWorld;vec2 xOffsetScreen=ndcToScreen(ndcXOffset/ndcXOffset.w);vec4 ndcYOffset=projectionMatrix*modelViewMatrix*yOffsetWorld;vec2 yOffsetScreen=ndcToScreen(ndcYOffset/ndcYOffset.w);vec2 xAxisScreen=normalize(xOffsetScreen-tipScreen);vec2 yAxisScreen=normalize(yOffsetScreen-tipScreen);float padding=aaPaddingPx+outline;scaledWidthHeightPx=scaleByZoom();float halfWidth=scaledWidthHeightPx.x/2.+padding;float quadHeight=scaledWidthHeightPx.y+padding*2.;vec2 vertexScreen=(tipScreen+yAxisScreen*paddingPx)+xAxisScreen*halfWidth*offset.x+yAxisScreen*quadHeight*offset.y;vec2 ndcVert=screenToNdc(vertexScreen);vOffsetPx=vec2(offset.x*halfWidth,offset.y*quadHeight);gl_Position=vec4(ndcVert*ndcTip.w,ndcTip.z,ndcTip.w);}"},5311:e=>{e.exports="precision highp float;uniform float opacity;uniform float centerSpacing;uniform float radius;uniform vec3 color;void main(){vec2 center=mod(gl_FragCoord.xy,vec2(centerSpacing))-vec2(centerSpacing*0.5);float polkaDot=1.-smoothstep(radius-(radius*0.2),radius,length(center));gl_FragColor=vec4(color,opacity*polkaDot);}"},26274:e=>{e.exports="precision highp float;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;attribute vec3 position;void main(){gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},4014:e=>{e.exports="#define ANTIALIAS_WIDTH  1.0\nprecision highp float;uniform vec3 outlineColor;uniform vec3 baseColor;uniform float radius;uniform float opacity;uniform float outlinePct;varying vec3 vPosition;void main(){float fragRadius=length(vPosition.xz);float outlineRadius=radius*outlinePct;float smoothAmt=fwidth(fragRadius)*ANTIALIAS_WIDTH;float mixAmt=smoothstep(outlineRadius-smoothAmt,outlineRadius,fragRadius);gl_FragColor=vec4(mix(baseColor,outlineColor,mixAmt),1.);gl_FragColor.a=opacity*(1.-smoothstep(radius-smoothAmt,radius,fragRadius));}"},57216:e=>{e.exports="precision highp float;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;attribute vec3 position;varying vec3 vPosition;void main(){vPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},73403:e=>{e.exports="precision highp float;uniform vec3 baseColor;uniform float isDoor;varying vec3 vPosition;void main(){const float lineWidth=0.15;if(isDoor>0.){const float startZ=0.15;const float endZ=startZ+lineWidth;float alpha=(abs(vPosition.z)>startZ&&abs(vPosition.z)<endZ)?1.:0.;gl_FragColor=vec4(baseColor,alpha);}else{float alpha=(abs(vPosition.z)<lineWidth*0.5)?1.:0.;gl_FragColor=vec4(baseColor,alpha);}}"},27706:e=>{e.exports="precision highp float;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;attribute vec3 position;varying vec3 vPosition;void main(){vPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},56413:e=>{e.exports="#define ANTIALIAS_WIDTH  1.0\nprecision highp float;uniform float selectedWidth;uniform vec3 outlineColor;uniform vec3 color;uniform float opacity;uniform float width;uniform vec3 lineStart;uniform vec3 lineEnd;varying vec3 vWorldPos;float distanceBetween(vec2 l1,vec2 l2,vec2 p){float D=length(l2-l1);float N=abs((l2.x-l1.x)*(l1.y-p.y)-(l1.x-p.x)*(l2.y-l1.y));return N/D;}void main(){float distanceToLine=distanceBetween(lineStart.xz,lineEnd.xz,vWorldPos.xz);float aaWidth=fwidth(distanceToLine)*ANTIALIAS_WIDTH;float lineLerp=smoothstep(selectedWidth-aaWidth,selectedWidth,distanceToLine);float halfWidth=width*0.5;float aaOpacity=smoothstep(halfWidth,halfWidth-aaWidth,distanceToLine);gl_FragColor=mix(vec4(outlineColor,opacity*aaOpacity),vec4(color,opacity*aaOpacity),lineLerp);if(gl_FragColor.a<0.01){discard;}}"},33057:e=>{e.exports="precision highp float;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;attribute vec3 position;varying vec3 vWorldPos;void main(){vWorldPos=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},22999:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetRoomBounds"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"floors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"layer"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"vertices"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeUsed"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"layer"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeUsed"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"layer"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"vertices"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"centerLineBias"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"thickness"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"openings"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"relativeCenter"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lowerElevation"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"layer"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"rooms"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"layer"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"classifications"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"confidence"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"boundary"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"holes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"dimensionEstimates"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"area"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"areaIndoor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"depth"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"units"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"keywords"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetRoomClassifications"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"roomClassifications"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"defaultKeywords"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:1037}};t.loc.source={body:"query GetRoomBounds($modelId: ID!) {\n  model(id: $modelId) {\n    floors {\n      id\n      layer { id }\n      vertices(includeUsed: true) {\n        id\n        layer { id }\n        position {\n          x\n          y\n        }\n      }\n      edges(includeUsed: true) {\n        id\n        layer { id }\n        type\n        vertices { id }\n        centerLineBias\n        thickness\n        openings {\n          id\n          width\n          relativeCenter\n          type\n          height\n          lowerElevation\n          layer { id }\n        }\n      }\n    }\n    rooms {\n      id\n      layer { id }\n      floor { id }\n      classifications {\n        id\n        confidence\n        label\n      }\n      boundary {\n        edges { id }\n      }\n      holes {\n        edges { id }\n      }\n      dimensionEstimates {\n        area\n        areaIndoor\n        width\n        depth\n        height\n        units\n      }\n      label\n      keywords\n    }\n  }\n}\n\nquery GetRoomClassifications {\n   roomClassifications {\n    id\n    label\n    defaultKeywords\n  }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var s=e.type;"NamedType"===s.kind&&t.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var s={};function a(e,t){for(var i=0;i<e.definitions.length;i++){var s=e.definitions[i];if(s.name&&s.name.value==t)return s}}function o(e,t){var i={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=s[t]||new Set,n=new Set,r=new Set;for(o.forEach((function(e){r.add(e)}));r.size>0;){var d=r;r=new Set,d.forEach((function(e){n.has(e)||(n.add(e),(s[e]||new Set).forEach((function(e){r.add(e)})))}))}return n.forEach((function(t){var s=a(e,t);s&&i.definitions.push(s)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),s[e.name.value]=t}})),e.exports=t,e.exports.GetRoomBounds=o(t,"GetRoomBounds"),e.exports.GetRoomClassifications=o(t,"GetRoomClassifications")}}]);